{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/lib/calculations.ts"],"sourcesContent":["import { Transaction, Account, PLRow, PLSummary, TransactionTag, PLSection } from '@/types';\n\n// Get all transactions for an account (including children)\nexport function getAccountTransactions(\n  accountCode: string,\n  transactions: Transaction[],\n  accounts: Map<string, Account>,\n  tags: Record<string, TransactionTag>,\n  includeTagged: boolean = false\n): Transaction[] {\n  const account = accounts.get(accountCode);\n  if (!account) return [];\n\n  // Get direct transactions\n  let result = transactions.filter(t => {\n    const matchesAccount = t.accountCode === accountCode ||\n      (t.parentAccountCode === accountCode && !accounts.has(t.accountCode));\n    const isTagged = tags[t.id] !== undefined;\n    return matchesAccount && (includeTagged || !isTagged);\n  });\n\n  // Add child account transactions\n  for (const childCode of account.children) {\n    result = result.concat(\n      getAccountTransactions(childCode, transactions, accounts, tags, includeTagged)\n    );\n  }\n\n  return result;\n}\n\n// Calculate monthly amounts for an account\nexport function calculateMonthlyAmounts(\n  accountCode: string,\n  transactions: Transaction[],\n  accounts: Map<string, Account>,\n  months: string[],\n  tags: Record<string, TransactionTag>\n): { monthlyAmounts: Record<string, number>; ytdTotal: number; transactionCount: number } {\n  const accountTransactions = getAccountTransactions(accountCode, transactions, accounts, tags);\n\n  const monthlyAmounts: Record<string, number> = {};\n  months.forEach(m => { monthlyAmounts[m] = 0; });\n\n  let ytdTotal = 0;\n\n  for (const txn of accountTransactions) {\n    if (txn.month && monthlyAmounts[txn.month] !== undefined) {\n      monthlyAmounts[txn.month] += txn.amount;\n      ytdTotal += txn.amount;\n    }\n  }\n\n  return { monthlyAmounts, ytdTotal, transactionCount: accountTransactions.length };\n}\n\n// Build P&L rows for a section\nexport function buildPLRows(\n  section: PLSection,\n  transactions: Transaction[],\n  accounts: Map<string, Account>,\n  months: string[],\n  tags: Record<string, TransactionTag>\n): PLRow[] {\n  const rows: PLRow[] = [];\n\n  // Get top-level accounts for this section\n  const topLevelAccounts = Array.from(accounts.values())\n    .filter(a => a.section === section && a.parentCode === null)\n    .sort((a, b) => a.code.localeCompare(b.code));\n\n  for (const account of topLevelAccounts) {\n    const { monthlyAmounts, ytdTotal, transactionCount } = calculateMonthlyAmounts(\n      account.code, transactions, accounts, months, tags\n    );\n\n    // Only add if there's activity\n    if (ytdTotal !== 0 || transactionCount > 0) {\n      rows.push({\n        accountCode: account.code,\n        account,\n        monthlyAmounts,\n        ytdTotal,\n        transactionCount\n      });\n    }\n  }\n\n  return rows;\n}\n\n// Calculate P&L summary metrics\nexport function calculatePLSummary(\n  transactions: Transaction[],\n  accounts: Map<string, Account>,\n  tags: Record<string, TransactionTag>\n): PLSummary {\n  // Filter out tagged transactions\n  const activeTransactions = transactions.filter(t => !tags[t.id]);\n  const taggedTransactions = transactions.filter(t => tags[t.id]);\n\n  // Calculate by section\n  const bySection = (section: PLSection) =>\n    activeTransactions\n      .filter(t => {\n        const account = accounts.get(t.accountCode);\n        if (!account) return false;\n        // Check if this account or its parent matches the section\n        if (account.section === section) return true;\n        if (t.parentAccountCode) {\n          const parent = accounts.get(t.parentAccountCode);\n          if (parent?.section === section) return true;\n        }\n        return false;\n      })\n      .reduce((sum, t) => sum + t.amount, 0);\n\n  // Revenue breakdown\n  const revenueTransactions = activeTransactions.filter(t => {\n    const code = parseInt(t.accountCode, 10);\n    return code >= 4000 && code < 4100;\n  });\n\n  // Gross revenue (4000 Sales + 4030 Shipping)\n  const grossRevenue = revenueTransactions\n    .filter(t => t.accountCode === '4000' || t.accountCode === '4030')\n    .reduce((sum, t) => sum + t.amount, 0);\n\n  // Contra revenue (discounts, refunds, chargebacks - these are negative)\n  const contraRevenue = revenueTransactions\n    .filter(t => t.accountCode === '4010' || t.accountCode === '4020' || t.accountCode === '4040')\n    .reduce((sum, t) => sum + t.amount, 0);\n\n  const netRevenue = grossRevenue + contraRevenue;\n\n  // Cost sections\n  const totalCOGS = bySection('cogs');\n  const totalCostOfSales = bySection('costOfSales');\n  const totalOpEx = bySection('operatingExpenses');\n  const otherIncome = bySection('otherIncome');\n\n  // Calculated metrics\n  const grossProfit = netRevenue - totalCOGS - totalCostOfSales;\n  const grossMargin = netRevenue !== 0 ? (grossProfit / netRevenue) * 100 : 0;\n  const netIncome = grossProfit - totalOpEx + otherIncome;\n  const netMargin = netRevenue !== 0 ? (netIncome / netRevenue) * 100 : 0;\n\n  // Tagged items - use net amount (not absolute) to match exclusions display\n  const taggedAmount = taggedTransactions.reduce((sum, t) => sum + t.amount, 0);\n\n  return {\n    grossRevenue,\n    netRevenue,\n    totalCOGS,\n    totalCostOfSales,\n    grossProfit,\n    grossMargin,\n    totalOpEx,\n    otherIncome,\n    netIncome,\n    netMargin,\n    taggedItemsCount: taggedTransactions.length,\n    taggedAmount\n  };\n}\n\n// Group transactions by month\nexport function groupTransactionsByMonth(transactions: Transaction[]): Record<string, Transaction[]> {\n  const grouped: Record<string, Transaction[]> = {};\n\n  for (const txn of transactions) {\n    if (!grouped[txn.month]) {\n      grouped[txn.month] = [];\n    }\n    grouped[txn.month].push(txn);\n  }\n\n  // Sort transactions within each month by date\n  for (const month of Object.keys(grouped)) {\n    grouped[month].sort((a, b) => {\n      const dateA = new Date(a.transactionDate);\n      const dateB = new Date(b.transactionDate);\n      return dateA.getTime() - dateB.getTime();\n    });\n  }\n\n  return grouped;\n}\n\n// Get tagged transactions grouped by category and sub-account\nexport function getTaggedTransactionsGrouped(\n  transactions: Transaction[],\n  tags: Record<string, TransactionTag>\n): Record<string, Record<string, Transaction[]>> {\n  const result: Record<string, Record<string, Transaction[]>> = {\n    personal: {},\n    nonRecurring: {}\n  };\n\n  for (const txn of transactions) {\n    const tag = tags[txn.id];\n    if (!tag) continue;\n\n    if (!result[tag.category][tag.subAccount]) {\n      result[tag.category][tag.subAccount] = [];\n    }\n    result[tag.category][tag.subAccount].push(txn);\n  }\n\n  return result;\n}\n\n// Calculate section total for a month\nexport function calculateSectionMonthlyTotal(\n  section: PLSection,\n  transactions: Transaction[],\n  accounts: Map<string, Account>,\n  month: string,\n  tags: Record<string, TransactionTag>\n): number {\n  return transactions\n    .filter(t => {\n      if (tags[t.id]) return false;\n      if (t.month !== month) return false;\n\n      const account = accounts.get(t.accountCode);\n      if (!account) return false;\n\n      if (account.section === section) return true;\n      if (t.parentAccountCode) {\n        const parent = accounts.get(t.parentAccountCode);\n        if (parent?.section === section) return true;\n      }\n      return false;\n    })\n    .reduce((sum, t) => sum + t.amount, 0);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/pnl/SummaryCards.tsx"],"sourcesContent":["'use client';\n\nimport { useMemo } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { calculatePLSummary } from '@/lib/calculations';\nimport { formatCurrency } from '@/lib/csvParser';\n\nexport function SummaryCards() {\n  const { state } = usePL();\n\n  const summary = useMemo(() => {\n    if (state.transactions.length === 0) return null;\n    return calculatePLSummary(state.transactions, state.accounts, state.tags);\n  }, [state.transactions, state.accounts, state.tags]);\n\n  if (!summary) return null;\n\n  const cards = [\n    {\n      label: 'Net Revenue',\n      value: summary.netRevenue,\n      color: 'bg-blue-50 border-blue-200',\n      textColor: 'text-blue-700',\n      valueColor: 'text-blue-900'\n    },\n    {\n      label: 'Net Income',\n      value: summary.netIncome,\n      subLabel: `${summary.netMargin.toFixed(1)}% margin`,\n      color: summary.netIncome >= 0 ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200',\n      textColor: summary.netIncome >= 0 ? 'text-green-700' : 'text-red-700',\n      valueColor: summary.netIncome >= 0 ? 'text-green-900' : 'text-red-900'\n    }\n  ];\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8\">\n      {cards.map((card) => (\n        <div\n          key={card.label}\n          className={`${card.color} border rounded-xl p-5 shadow-sm transition-shadow hover:shadow-md`}\n        >\n          <div className={`text-sm font-medium ${card.textColor} uppercase tracking-wide`}>\n            {card.label}\n          </div>\n          <div className={`text-3xl font-bold ${card.valueColor} mt-2 font-mono`}>\n            {formatCurrency(card.value)}\n          </div>\n          {card.subLabel && (\n            <div className={`text-sm ${card.textColor} mt-2 opacity-80`}>\n              {card.subLabel}\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOO,SAAS;IACd,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,qJAAK;IAEvB,MAAM,UAAU,IAAA,gOAAO,EAAC;QACtB,IAAI,MAAM,YAAY,CAAC,MAAM,KAAK,GAAG,OAAO;QAC5C,OAAO,IAAA,gKAAkB,EAAC,MAAM,YAAY,EAAE,MAAM,QAAQ,EAAE,MAAM,IAAI;IAC1E,GAAG;QAAC,MAAM,YAAY;QAAE,MAAM,QAAQ;QAAE,MAAM,IAAI;KAAC;IAEnD,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,QAAQ;QACZ;YACE,OAAO;YACP,OAAO,QAAQ,UAAU;YACzB,OAAO;YACP,WAAW;YACX,YAAY;QACd;QACA;YACE,OAAO;YACP,OAAO,QAAQ,SAAS;YACxB,UAAU,GAAG,QAAQ,SAAS,CAAC,OAAO,CAAC,GAAG,QAAQ,CAAC;YACnD,OAAO,QAAQ,SAAS,IAAI,IAAI,iCAAiC;YACjE,WAAW,QAAQ,SAAS,IAAI,IAAI,mBAAmB;YACvD,YAAY,QAAQ,SAAS,IAAI,IAAI,mBAAmB;QAC1D;KACD;IAED,qBACE,8PAAC;QAAI,WAAU;kBACZ,MAAM,GAAG,CAAC,CAAC,qBACV,8PAAC;gBAEC,WAAW,GAAG,KAAK,KAAK,CAAC,kEAAkE,CAAC;;kCAE5F,8PAAC;wBAAI,WAAW,CAAC,oBAAoB,EAAE,KAAK,SAAS,CAAC,wBAAwB,CAAC;kCAC5E,KAAK,KAAK;;;;;;kCAEb,8PAAC;wBAAI,WAAW,CAAC,mBAAmB,EAAE,KAAK,UAAU,CAAC,eAAe,CAAC;kCACnE,IAAA,yJAAc,EAAC,KAAK,KAAK;;;;;;oBAE3B,KAAK,QAAQ,kBACZ,8PAAC;wBAAI,WAAW,CAAC,QAAQ,EAAE,KAAK,SAAS,CAAC,gBAAgB,CAAC;kCACxD,KAAK,QAAQ;;;;;;;eAXb,KAAK,KAAK;;;;;;;;;;AAkBzB"}},
    {"offset": {"line": 283, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/ui/ChevronIcon.tsx"],"sourcesContent":["'use client';\n\ninterface ChevronIconProps {\n  expanded: boolean;\n  className?: string;\n}\n\nexport function ChevronIcon({ expanded, className = '' }: ChevronIconProps) {\n  return (\n    <svg\n      className={`w-4 h-4 transition-transform duration-200 ${expanded ? 'rotate-90' : ''} ${className}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <path\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        strokeWidth={2}\n        d=\"M9 5l7 7-7 7\"\n      />\n    </svg>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AAOO,SAAS,YAAY,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAoB;IACxE,qBACE,8PAAC;QACC,WAAW,CAAC,0CAA0C,EAAE,WAAW,cAAc,GAAG,CAAC,EAAE,WAAW;QAClG,MAAK;QACL,QAAO;QACP,SAAQ;kBAER,cAAA,8PAAC;YACC,eAAc;YACd,gBAAe;YACf,aAAa;YACb,GAAE;;;;;;;;;;;AAIV"}},
    {"offset": {"line": 316, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/tagging/TagModal.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { Transaction } from '@/types';\nimport { usePL } from '@/context/PLContext';\nimport { formatCurrency } from '@/lib/csvParser';\n\ninterface TagModalProps {\n  transaction: Transaction;\n  onClose: () => void;\n}\n\nexport function TagModal({ transaction, onClose }: TagModalProps) {\n  const { state, dispatch } = usePL();\n  const [activeTab, setActiveTab] = useState<'personal' | 'nonRecurring'>('personal');\n  const [newSubAccount, setNewSubAccount] = useState('');\n  const [showNewInput, setShowNewInput] = useState(false);\n\n  const handleTag = (subAccount: string) => {\n    dispatch({\n      type: 'TAG_TRANSACTION',\n      payload: {\n        transactionId: transaction.id,\n        tag: {\n          category: activeTab,\n          subAccount,\n          taggedAt: Date.now()\n        }\n      }\n    });\n    onClose();\n  };\n\n  const handleAddNew = () => {\n    if (newSubAccount.trim()) {\n      dispatch({\n        type: 'ADD_SUB_ACCOUNT',\n        payload: { category: activeTab, name: newSubAccount.trim() }\n      });\n      handleTag(newSubAccount.trim());\n    }\n  };\n\n  const subAccounts = state.tagConfig[activeTab];\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-white rounded-lg shadow-xl w-full max-w-md mx-4\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"px-4 py-3 border-b border-slate-200\">\n          <h3 className=\"font-semibold text-slate-900\">Tag Transaction</h3>\n          <p className=\"text-sm text-slate-500 mt-1 truncate\">\n            {transaction.name || transaction.memo} - {formatCurrency(transaction.amount)}\n          </p>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"flex border-b border-slate-200\">\n          <button\n            className={`flex-1 px-4 py-2 text-sm font-medium border-b-2 transition-colors\n              ${activeTab === 'personal'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-slate-500 hover:text-slate-700'\n              }\n            `}\n            onClick={() => setActiveTab('personal')}\n          >\n            Personal\n          </button>\n          <button\n            className={`flex-1 px-4 py-2 text-sm font-medium border-b-2 transition-colors\n              ${activeTab === 'nonRecurring'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-slate-500 hover:text-slate-700'\n              }\n            `}\n            onClick={() => setActiveTab('nonRecurring')}\n          >\n            Non-Recurring\n          </button>\n        </div>\n\n        {/* Sub-account list */}\n        <div className=\"p-4 max-h-64 overflow-y-auto\">\n          <div className=\"space-y-2\">\n            {subAccounts.map(subAccount => (\n              <button\n                key={subAccount}\n                onClick={() => handleTag(subAccount)}\n                className=\"w-full text-left px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700 transition-colors\"\n              >\n                {subAccount}\n              </button>\n            ))}\n\n            {/* Add new option */}\n            {!showNewInput ? (\n              <button\n                onClick={() => setShowNewInput(true)}\n                className=\"w-full text-left px-3 py-2 rounded-lg hover:bg-blue-50 text-blue-600 transition-colors flex items-center gap-2\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                </svg>\n                Add new sub-account\n              </button>\n            ) : (\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"text\"\n                  value={newSubAccount}\n                  onChange={e => setNewSubAccount(e.target.value)}\n                  placeholder=\"Enter name...\"\n                  className=\"flex-1 px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  autoFocus\n                  onKeyDown={e => {\n                    if (e.key === 'Enter') handleAddNew();\n                    if (e.key === 'Escape') setShowNewInput(false);\n                  }}\n                />\n                <button\n                  onClick={handleAddNew}\n                  disabled={!newSubAccount.trim()}\n                  className=\"px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Add\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"px-4 py-3 border-t border-slate-200 flex justify-end\">\n          <button\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm text-slate-600 hover:text-slate-800\"\n          >\n            Cancel\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AALA;;;;;AAYO,SAAS,SAAS,EAAE,WAAW,EAAE,OAAO,EAAiB;IAC9D,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAA,qJAAK;IACjC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iOAAQ,EAA8B;IACxE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iOAAQ,EAAC;IACnD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iOAAQ,EAAC;IAEjD,MAAM,YAAY,CAAC;QACjB,SAAS;YACP,MAAM;YACN,SAAS;gBACP,eAAe,YAAY,EAAE;gBAC7B,KAAK;oBACH,UAAU;oBACV;oBACA,UAAU,KAAK,GAAG;gBACpB;YACF;QACF;QACA;IACF;IAEA,MAAM,eAAe;QACnB,IAAI,cAAc,IAAI,IAAI;YACxB,SAAS;gBACP,MAAM;gBACN,SAAS;oBAAE,UAAU;oBAAW,MAAM,cAAc,IAAI;gBAAG;YAC7D;YACA,UAAU,cAAc,IAAI;QAC9B;IACF;IAEA,MAAM,cAAc,MAAM,SAAS,CAAC,UAAU;IAE9C,qBACE,8PAAC;QACC,WAAU;QACV,SAAS;kBAET,cAAA,8PAAC;YACC,WAAU;YACV,SAAS,CAAA,IAAK,EAAE,eAAe;;8BAG/B,8PAAC;oBAAI,WAAU;;sCACb,8PAAC;4BAAG,WAAU;sCAA+B;;;;;;sCAC7C,8PAAC;4BAAE,WAAU;;gCACV,YAAY,IAAI,IAAI,YAAY,IAAI;gCAAC;gCAAI,IAAA,yJAAc,EAAC,YAAY,MAAM;;;;;;;;;;;;;8BAK/E,8PAAC;oBAAI,WAAU;;sCACb,8PAAC;4BACC,WAAW,CAAC;cACV,EAAE,cAAc,aACZ,kCACA,yDACH;YACH,CAAC;4BACD,SAAS,IAAM,aAAa;sCAC7B;;;;;;sCAGD,8PAAC;4BACC,WAAW,CAAC;cACV,EAAE,cAAc,iBACZ,kCACA,yDACH;YACH,CAAC;4BACD,SAAS,IAAM,aAAa;sCAC7B;;;;;;;;;;;;8BAMH,8PAAC;oBAAI,WAAU;8BACb,cAAA,8PAAC;wBAAI,WAAU;;4BACZ,YAAY,GAAG,CAAC,CAAA,2BACf,8PAAC;oCAEC,SAAS,IAAM,UAAU;oCACzB,WAAU;8CAET;mCAJI;;;;;4BASR,CAAC,6BACA,8PAAC;gCACC,SAAS,IAAM,gBAAgB;gCAC/B,WAAU;;kDAEV,8PAAC;wCAAI,WAAU;wCAAU,MAAK;wCAAO,QAAO;wCAAe,SAAQ;kDACjE,cAAA,8PAAC;4CAAK,eAAc;4CAAQ,gBAAe;4CAAQ,aAAa;4CAAG,GAAE;;;;;;;;;;;oCACjE;;;;;;qDAIR,8PAAC;gCAAI,WAAU;;kDACb,8PAAC;wCACC,MAAK;wCACL,OAAO;wCACP,UAAU,CAAA,IAAK,iBAAiB,EAAE,MAAM,CAAC,KAAK;wCAC9C,aAAY;wCACZ,WAAU;wCACV,SAAS;wCACT,WAAW,CAAA;4CACT,IAAI,EAAE,GAAG,KAAK,SAAS;4CACvB,IAAI,EAAE,GAAG,KAAK,UAAU,gBAAgB;wCAC1C;;;;;;kDAEF,8PAAC;wCACC,SAAS;wCACT,UAAU,CAAC,cAAc,IAAI;wCAC7B,WAAU;kDACX;;;;;;;;;;;;;;;;;;;;;;;8BAST,8PAAC;oBAAI,WAAU;8BACb,cAAA,8PAAC;wBACC,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;;;;;;;;;;;;AAOX"}},
    {"offset": {"line": 550, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/pnl/TransactionRow.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { Transaction } from '@/types';\nimport { usePL } from '@/context/PLContext';\nimport { formatCurrency } from '@/lib/csvParser';\nimport { TagModal } from '@/components/tagging/TagModal';\n\ninterface TransactionRowProps {\n  transaction: Transaction;\n}\n\nexport function TransactionRow({ transaction }: TransactionRowProps) {\n  const { state, dispatch } = usePL();\n  const [showTagModal, setShowTagModal] = useState(false);\n\n  const tag = state.tags[transaction.id];\n  const isTagged = !!tag;\n\n  const handleUntag = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    dispatch({ type: 'UNTAG_TRANSACTION', payload: transaction.id });\n  };\n\n  const formatDate = (dateStr: string) => {\n    const [month, day] = dateStr.split('/');\n    return `${month}/${day}`;\n  };\n\n  return (\n    <>\n      <div\n        className={`\n          flex items-center gap-3 py-1.5 px-2 rounded text-sm\n          ${isTagged ? 'bg-amber-50 opacity-60' : 'bg-white hover:bg-slate-50'}\n        `}\n      >\n        {/* Date */}\n        <span className=\"text-slate-400 font-mono text-xs w-12 flex-shrink-0\">\n          {formatDate(transaction.transactionDate)}\n        </span>\n\n        {/* Name/Vendor */}\n        <span className={`font-medium w-32 flex-shrink-0 truncate ${isTagged ? 'line-through text-slate-400' : 'text-slate-700'}`}>\n          {transaction.name || '-'}\n        </span>\n\n        {/* Memo */}\n        <span className={`flex-1 truncate ${isTagged ? 'line-through text-slate-400' : 'text-slate-500'}`}>\n          {transaction.memo || transaction.transactionType}\n        </span>\n\n        {/* Tag badge */}\n        {isTagged && (\n          <span className=\"bg-amber-200 text-amber-800 text-xs px-2 py-0.5 rounded-full flex-shrink-0\">\n            {tag.subAccount}\n          </span>\n        )}\n\n        {/* Amount */}\n        <span className={`font-mono text-right w-24 flex-shrink-0\n          ${isTagged ? 'line-through text-slate-400' : transaction.amount < 0 ? 'text-red-600' : 'text-slate-700'}\n        `}>\n          {formatCurrency(transaction.amount)}\n        </span>\n\n        {/* Tag/Untag button */}\n        {isTagged ? (\n          <button\n            onClick={handleUntag}\n            className=\"text-xs text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-50 flex-shrink-0\"\n          >\n            Untag\n          </button>\n        ) : (\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              setShowTagModal(true);\n            }}\n            className=\"text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded hover:bg-blue-50 flex-shrink-0\"\n          >\n            Tag\n          </button>\n        )}\n      </div>\n\n      {/* Tag Modal */}\n      {showTagModal && (\n        <TagModal\n          transaction={transaction}\n          onClose={() => setShowTagModal(false)}\n        />\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AACA;AANA;;;;;;AAYO,SAAS,eAAe,EAAE,WAAW,EAAuB;IACjE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAA,qJAAK;IACjC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iOAAQ,EAAC;IAEjD,MAAM,MAAM,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;IACtC,MAAM,WAAW,CAAC,CAAC;IAEnB,MAAM,cAAc,CAAC;QACnB,EAAE,eAAe;QACjB,SAAS;YAAE,MAAM;YAAqB,SAAS,YAAY,EAAE;QAAC;IAChE;IAEA,MAAM,aAAa,CAAC;QAClB,MAAM,CAAC,OAAO,IAAI,GAAG,QAAQ,KAAK,CAAC;QACnC,OAAO,GAAG,MAAM,CAAC,EAAE,KAAK;IAC1B;IAEA,qBACE;;0BACE,8PAAC;gBACC,WAAW,CAAC;;UAEV,EAAE,WAAW,2BAA2B,6BAA6B;QACvE,CAAC;;kCAGD,8PAAC;wBAAK,WAAU;kCACb,WAAW,YAAY,eAAe;;;;;;kCAIzC,8PAAC;wBAAK,WAAW,CAAC,wCAAwC,EAAE,WAAW,gCAAgC,kBAAkB;kCACtH,YAAY,IAAI,IAAI;;;;;;kCAIvB,8PAAC;wBAAK,WAAW,CAAC,gBAAgB,EAAE,WAAW,gCAAgC,kBAAkB;kCAC9F,YAAY,IAAI,IAAI,YAAY,eAAe;;;;;;oBAIjD,0BACC,8PAAC;wBAAK,WAAU;kCACb,IAAI,UAAU;;;;;;kCAKnB,8PAAC;wBAAK,WAAW,CAAC;UAChB,EAAE,WAAW,gCAAgC,YAAY,MAAM,GAAG,IAAI,iBAAiB,iBAAiB;QAC1G,CAAC;kCACE,IAAA,yJAAc,EAAC,YAAY,MAAM;;;;;;oBAInC,yBACC,8PAAC;wBACC,SAAS;wBACT,WAAU;kCACX;;;;;6CAID,8PAAC;wBACC,SAAS,CAAC;4BACR,EAAE,eAAe;4BACjB,gBAAgB;wBAClB;wBACA,WAAU;kCACX;;;;;;;;;;;;YAOJ,8BACC,8PAAC,qKAAQ;gBACP,aAAa;gBACb,SAAS,IAAM,gBAAgB;;;;;;;;AAKzC"}},
    {"offset": {"line": 672, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/pnl/PLRow.tsx"],"sourcesContent":["'use client';\n\nimport { useMemo } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { PLRow as PLRowType, Transaction } from '@/types';\nimport { ChevronIcon } from '@/components/ui/ChevronIcon';\nimport { formatCurrency, formatMonth } from '@/lib/csvParser';\nimport { getAccountTransactions, groupTransactionsByMonth, calculateMonthlyAmounts } from '@/lib/calculations';\nimport { TransactionRow } from './TransactionRow';\n\ninterface PLRowProps {\n  row: PLRowType;\n  months: string[];\n  depth?: number;\n  isChild?: boolean;\n  allowDrillDown?: boolean;\n}\n\nexport function PLRow({ row, months, depth = 0, isChild = false, allowDrillDown = true }: PLRowProps) {\n  const { state, dispatch } = usePL();\n  const { expandedAccounts, expandedMonths, transactions, accounts, tags } = state;\n\n  const isExpanded = allowDrillDown && expandedAccounts.has(row.accountCode);\n  const hasChildren = row.account.children.length > 0;\n  const hasTransactions = row.transactionCount > 0;\n  const isExpandable = allowDrillDown && (hasChildren || hasTransactions);\n\n  // Get child rows if expanded\n  const childRows = useMemo(() => {\n    if (!isExpanded || !hasChildren) return [];\n\n    return row.account.children\n      .map(childCode => {\n        const childAccount = accounts.get(childCode);\n        if (!childAccount) return null;\n\n        const { monthlyAmounts, ytdTotal, transactionCount } = calculateMonthlyAmounts(\n          childCode, transactions, accounts, months, tags\n        );\n\n        if (ytdTotal === 0 && transactionCount === 0) return null;\n\n        return {\n          accountCode: childCode,\n          account: childAccount,\n          monthlyAmounts,\n          ytdTotal,\n          transactionCount\n        } as PLRowType;\n      })\n      .filter((r): r is PLRowType => r !== null);\n  }, [isExpanded, hasChildren, row.account.children, accounts, transactions, months, tags]);\n\n  // Get transactions grouped by month if expanded (only for leaf nodes)\n  const transactionsByMonth = useMemo(() => {\n    if (!isExpanded || hasChildren) return {};\n\n    const txns = getAccountTransactions(row.accountCode, transactions, accounts, tags);\n    return groupTransactionsByMonth(txns);\n  }, [isExpanded, hasChildren, row.accountCode, transactions, accounts, tags]);\n\n  const handleToggle = () => {\n    if (isExpandable) {\n      dispatch({ type: 'TOGGLE_ACCOUNT', payload: row.accountCode });\n    }\n  };\n\n  const handleMonthToggle = (month: string) => {\n    const key = `${row.accountCode}-${month}`;\n    dispatch({ type: 'TOGGLE_MONTH', payload: key });\n  };\n\n  const isMonthExpanded = (month: string) => {\n    return expandedMonths.has(`${row.accountCode}-${month}`);\n  };\n\n  const indentPadding = depth * 20;\n\n  return (\n    <>\n      {/* Main account row */}\n      <tr\n        className={`\n          ${isChild ? 'bg-slate-50/50' : 'bg-white'}\n          ${isExpandable ? 'cursor-pointer hover:bg-slate-100' : ''}\n          border-b border-slate-100\n        `}\n        onClick={handleToggle}\n      >\n        {/* Account name column */}\n        <td\n          className=\"sticky left-0 bg-inherit px-3 py-2 font-medium text-slate-900 whitespace-nowrap z-10\"\n          style={{ paddingLeft: `${12 + indentPadding}px` }}\n        >\n          <div className=\"flex items-center gap-2\">\n            {isExpandable ? (\n              <ChevronIcon expanded={isExpanded} className=\"text-slate-400 flex-shrink-0\" />\n            ) : (\n              <span className=\"w-4\" />\n            )}\n            <span className={depth > 0 ? 'text-sm' : ''}>\n              {row.account.name}\n            </span>\n          </div>\n        </td>\n\n        {/* Monthly amounts */}\n        {months.map(month => (\n          <td\n            key={month}\n            className={`px-3 py-2 text-right font-mono text-sm whitespace-nowrap\n              ${row.monthlyAmounts[month] < 0 ? 'text-red-600' : 'text-slate-700'}\n            `}\n          >\n            {row.monthlyAmounts[month] !== 0 ? formatCurrency(row.monthlyAmounts[month]) : '-'}\n          </td>\n        ))}\n\n        {/* YTD Total */}\n        <td\n          className={`px-3 py-2 text-right font-mono text-sm font-semibold whitespace-nowrap bg-violet-50 border-l-2 border-violet-200\n            ${row.ytdTotal < 0 ? 'text-red-600' : 'text-violet-900'}\n          `}\n        >\n          {formatCurrency(row.ytdTotal)}\n        </td>\n      </tr>\n\n      {/* Child account rows */}\n      {isExpanded && childRows.map(childRow => (\n        <PLRow\n          key={childRow.accountCode}\n          row={childRow}\n          months={months}\n          depth={depth + 1}\n          isChild\n          allowDrillDown={allowDrillDown}\n        />\n      ))}\n\n      {/* Transaction month groups (for leaf nodes) */}\n      {isExpanded && !hasChildren && Object.keys(transactionsByMonth).length > 0 && (\n        <>\n          {months.filter(m => transactionsByMonth[m]?.length > 0).map(month => {\n            const monthTxns = transactionsByMonth[month] || [];\n            const monthExpanded = isMonthExpanded(month);\n\n            return (\n              <tr key={`${row.accountCode}-${month}-group`} className=\"bg-slate-50\">\n                <td\n                  colSpan={months.length + 2}\n                  className=\"px-3 py-1\"\n                  style={{ paddingLeft: `${32 + indentPadding}px` }}\n                >\n                  <div\n                    className=\"flex items-center gap-2 text-sm text-slate-600 cursor-pointer hover:text-slate-900\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleMonthToggle(month);\n                    }}\n                  >\n                    <ChevronIcon expanded={monthExpanded} className=\"text-slate-400\" />\n                    <span className=\"font-medium\">{formatMonth(month)}</span>\n                    <span className=\"text-slate-400\">({monthTxns.length} transactions)</span>\n                    <span className=\"ml-auto font-mono\">\n                      {formatCurrency(monthTxns.reduce((sum, t) => sum + t.amount, 0))}\n                    </span>\n                  </div>\n\n                  {/* Individual transactions */}\n                  {monthExpanded && (\n                    <div className=\"mt-2 space-y-1 pb-2\">\n                      {monthTxns.map(txn => (\n                        <TransactionRow key={txn.id} transaction={txn} />\n                      ))}\n                    </div>\n                  )}\n                </td>\n              </tr>\n            );\n          })}\n        </>\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 939, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/pnl/PLSection.tsx"],"sourcesContent":["'use client';\n\nimport { useMemo } from 'react';\nimport { PLSection as PLSectionType, PLRow as PLRowType } from '@/types';\nimport { usePL } from '@/context/PLContext';\nimport { buildPLRows, calculateSectionMonthlyTotal } from '@/lib/calculations';\nimport { formatCurrency, formatMonth } from '@/lib/csvParser';\nimport { PLRow } from './PLRow';\n\ninterface PLSectionProps {\n  section: PLSectionType;\n  title: string;\n  colorClass: string;\n  totalColorClass?: string;\n  allowDrillDown?: boolean;\n}\n\nexport function PLSection({ section, title, colorClass, totalColorClass, allowDrillDown = true }: PLSectionProps) {\n  const { state } = usePL();\n  const { transactions, accounts, months, tags } = state;\n\n  const rows = useMemo(() => {\n    if (transactions.length === 0) return [];\n    return buildPLRows(section, transactions, accounts, months, tags);\n  }, [section, transactions, accounts, months, tags]);\n\n  const sectionTotals = useMemo(() => {\n    const totals: Record<string, number> = {};\n    let ytd = 0;\n\n    months.forEach(month => {\n      const total = calculateSectionMonthlyTotal(section, transactions, accounts, month, tags);\n      totals[month] = total;\n      ytd += total;\n    });\n\n    return { monthly: totals, ytd };\n  }, [section, transactions, accounts, months, tags]);\n\n  if (rows.length === 0) return null;\n\n  return (\n    <div className=\"mb-8\">\n      {/* Section Header */}\n      <div className={`flex items-center gap-3 mb-3`}>\n        <div className={`w-1.5 h-6 rounded-full ${colorClass}`} />\n        <h2 className=\"text-lg font-semibold text-slate-800\">{title}</h2>\n      </div>\n\n      {/* Table */}\n      <div className=\"overflow-x-auto border border-slate-200 rounded-xl shadow-sm bg-white\">\n        <table className=\"w-full min-w-max\">\n          <thead>\n            <tr className=\"bg-slate-50 border-b border-slate-200\">\n              <th className=\"sticky left-0 bg-slate-50 px-3 py-2 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-64 z-10\">\n                Account\n              </th>\n              {months.map(month => (\n                <th\n                  key={month}\n                  className=\"px-3 py-2 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider w-24\"\n                >\n                  {formatMonth(month)}\n                </th>\n              ))}\n              <th className=\"px-3 py-2 text-right text-xs font-semibold text-violet-700 uppercase tracking-wider w-28 bg-violet-100 border-l-2 border-violet-200\">\n                YTD Total\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {rows.map(row => (\n              <PLRow key={row.accountCode} row={row} months={months} allowDrillDown={allowDrillDown} />\n            ))}\n\n            {/* Section Total Row */}\n            <tr className={`${totalColorClass || 'bg-slate-50'} border-t-2 border-slate-300`}>\n              <td className=\"sticky left-0 bg-inherit px-3 py-2 font-bold text-slate-900\">\n                Total {title}\n              </td>\n              {months.map(month => (\n                <td\n                  key={month}\n                  className={`px-3 py-2 text-right font-mono text-sm font-bold\n                    ${sectionTotals.monthly[month] < 0 ? 'text-red-600' : 'text-slate-900'}\n                  `}\n                >\n                  {formatCurrency(sectionTotals.monthly[month])}\n                </td>\n              ))}\n              <td\n                className={`px-3 py-2 text-right font-mono text-sm font-bold bg-violet-100 border-l-2 border-violet-200\n                  ${sectionTotals.ytd < 0 ? 'text-red-600' : 'text-violet-900'}\n                `}\n              >\n                {formatCurrency(sectionTotals.ytd)}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AACA;AACA;AACA;AAPA;;;;;;;AAiBO,SAAS,UAAU,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,EAAE,eAAe,EAAE,iBAAiB,IAAI,EAAkB;IAC9G,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,qJAAK;IACvB,MAAM,EAAE,YAAY,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjD,MAAM,OAAO,IAAA,gOAAO,EAAC;QACnB,IAAI,aAAa,MAAM,KAAK,GAAG,OAAO,EAAE;QACxC,OAAO,IAAA,yJAAW,EAAC,SAAS,cAAc,UAAU,QAAQ;IAC9D,GAAG;QAAC;QAAS;QAAc;QAAU;QAAQ;KAAK;IAElD,MAAM,gBAAgB,IAAA,gOAAO,EAAC;QAC5B,MAAM,SAAiC,CAAC;QACxC,IAAI,MAAM;QAEV,OAAO,OAAO,CAAC,CAAA;YACb,MAAM,QAAQ,IAAA,0KAA4B,EAAC,SAAS,cAAc,UAAU,OAAO;YACnF,MAAM,CAAC,MAAM,GAAG;YAChB,OAAO;QACT;QAEA,OAAO;YAAE,SAAS;YAAQ;QAAI;IAChC,GAAG;QAAC;QAAS;QAAc;QAAU;QAAQ;KAAK;IAElD,IAAI,KAAK,MAAM,KAAK,GAAG,OAAO;IAE9B,qBACE,8PAAC;QAAI,WAAU;;0BAEb,8PAAC;gBAAI,WAAW,CAAC,4BAA4B,CAAC;;kCAC5C,8PAAC;wBAAI,WAAW,CAAC,uBAAuB,EAAE,YAAY;;;;;;kCACtD,8PAAC;wBAAG,WAAU;kCAAwC;;;;;;;;;;;;0BAIxD,8PAAC;gBAAI,WAAU;0BACb,cAAA,8PAAC;oBAAM,WAAU;;sCACf,8PAAC;sCACC,cAAA,8PAAC;gCAAG,WAAU;;kDACZ,8PAAC;wCAAG,WAAU;kDAAwH;;;;;;oCAGrI,OAAO,GAAG,CAAC,CAAA,sBACV,8PAAC;4CAEC,WAAU;sDAET,IAAA,sJAAW,EAAC;2CAHR;;;;;kDAMT,8PAAC;wCAAG,WAAU;kDAAsI;;;;;;;;;;;;;;;;;sCAKxJ,8PAAC;;gCACE,KAAK,GAAG,CAAC,CAAA,oBACR,8PAAC,2JAAK;wCAAuB,KAAK;wCAAK,QAAQ;wCAAQ,gBAAgB;uCAA3D,IAAI,WAAW;;;;;8CAI7B,8PAAC;oCAAG,WAAW,GAAG,mBAAmB,cAAc,4BAA4B,CAAC;;sDAC9E,8PAAC;4CAAG,WAAU;;gDAA8D;gDACnE;;;;;;;wCAER,OAAO,GAAG,CAAC,CAAA,sBACV,8PAAC;gDAEC,WAAW,CAAC;oBACV,EAAE,cAAc,OAAO,CAAC,MAAM,GAAG,IAAI,iBAAiB,iBAAiB;kBACzE,CAAC;0DAEA,IAAA,yJAAc,EAAC,cAAc,OAAO,CAAC,MAAM;+CALvC;;;;;sDAQT,8PAAC;4CACC,WAAW,CAAC;kBACV,EAAE,cAAc,GAAG,GAAG,IAAI,iBAAiB,kBAAkB;gBAC/D,CAAC;sDAEA,IAAA,yJAAc,EAAC,cAAc,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQjD"}},
    {"offset": {"line": 1139, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/pnl/GrossProfitRow.tsx"],"sourcesContent":["'use client';\n\nimport { useMemo } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { calculateSectionMonthlyTotal } from '@/lib/calculations';\nimport { formatCurrency, formatMonth } from '@/lib/csvParser';\n\ninterface GrossProfitRowProps {\n  type: 'grossProfit' | 'netIncome';\n}\n\nexport function GrossProfitRow({ type }: GrossProfitRowProps) {\n  const { state } = usePL();\n  const { transactions, accounts, months, tags } = state;\n\n  const calculations = useMemo(() => {\n    const revenue: Record<string, number> = {};\n    const cogs: Record<string, number> = {};\n    const costOfSales: Record<string, number> = {};\n    const opex: Record<string, number> = {};\n    const other: Record<string, number> = {};\n\n    let revenueYtd = 0, cogsYtd = 0, cosYtd = 0, opexYtd = 0, otherYtd = 0;\n\n    months.forEach(month => {\n      revenue[month] = calculateSectionMonthlyTotal('revenue', transactions, accounts, month, tags);\n      cogs[month] = calculateSectionMonthlyTotal('cogs', transactions, accounts, month, tags);\n      costOfSales[month] = calculateSectionMonthlyTotal('costOfSales', transactions, accounts, month, tags);\n      opex[month] = calculateSectionMonthlyTotal('operatingExpenses', transactions, accounts, month, tags);\n      other[month] = calculateSectionMonthlyTotal('otherIncome', transactions, accounts, month, tags);\n\n      revenueYtd += revenue[month];\n      cogsYtd += cogs[month];\n      cosYtd += costOfSales[month];\n      opexYtd += opex[month];\n      otherYtd += other[month];\n    });\n\n    const grossProfit: Record<string, number> = {};\n    const netIncome: Record<string, number> = {};\n    let gpYtd = 0, niYtd = 0;\n\n    months.forEach(month => {\n      grossProfit[month] = revenue[month] - cogs[month] - costOfSales[month];\n      netIncome[month] = grossProfit[month] - opex[month] + other[month];\n      gpYtd += grossProfit[month];\n      niYtd += netIncome[month];\n    });\n\n    return {\n      grossProfit: { monthly: grossProfit, ytd: gpYtd },\n      netIncome: { monthly: netIncome, ytd: niYtd },\n      revenue: { monthly: revenue, ytd: revenueYtd }\n    };\n  }, [transactions, accounts, months, tags]);\n\n  if (transactions.length === 0) return null;\n\n  const data = type === 'grossProfit' ? calculations.grossProfit : calculations.netIncome;\n  const label = type === 'grossProfit' ? 'Gross Profit' : 'Net Income';\n  const bgColor = type === 'grossProfit' ? 'bg-blue-50' : 'bg-green-50';\n  const borderColor = type === 'grossProfit' ? 'border-blue-200' : 'border-green-200';\n\n  // Calculate margin\n  const margin = calculations.revenue.ytd !== 0\n    ? (data.ytd / calculations.revenue.ytd) * 100\n    : 0;\n\n  return (\n    <div className={`mb-8 overflow-x-auto border ${borderColor} rounded-xl shadow-sm`}>\n      <table className=\"w-full min-w-max\">\n        <thead>\n          <tr className={`${bgColor} border-b ${borderColor}`}>\n            <th className=\"sticky left-0 bg-inherit px-3 py-2 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-64 z-10\">\n              &nbsp;\n            </th>\n            {months.map(month => (\n              <th\n                key={month}\n                className=\"px-3 py-2 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider w-24\"\n              >\n                {formatMonth(month)}\n              </th>\n            ))}\n            <th className=\"px-3 py-2 text-right text-xs font-semibold text-violet-700 uppercase tracking-wider w-28 bg-violet-100 border-l-2 border-violet-200\">\n              YTD Total\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr className={bgColor}>\n            <td className=\"sticky left-0 bg-inherit px-3 py-3 font-bold text-lg text-slate-900\">\n              {label}\n              <span className=\"ml-2 text-sm font-normal text-slate-500\">\n                ({margin.toFixed(1)}% margin)\n              </span>\n            </td>\n            {months.map(month => (\n              <td\n                key={month}\n                className={`px-3 py-3 text-right font-mono font-bold text-lg\n                  ${data.monthly[month] < 0 ? 'text-red-600' : 'text-slate-900'}\n                `}\n              >\n                {formatCurrency(data.monthly[month])}\n              </td>\n            ))}\n            <td\n              className={`px-3 py-3 text-right font-mono font-bold text-lg bg-violet-100 border-l-2 border-violet-200\n                ${data.ytd < 0 ? 'text-red-600' : 'text-violet-900'}\n              `}\n            >\n              {formatCurrency(data.ytd)}\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1329, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/pnl/KHBrokersView.tsx"],"sourcesContent":["'use client';\n\nimport { useMemo, useState } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { formatCurrency, formatMonth } from '@/lib/csvParser';\nimport { Transaction, TransactionTag } from '@/types';\nimport { ChevronIcon } from '@/components/ui/ChevronIcon';\nimport { TransactionRow } from './TransactionRow';\n\n// KH Brokers P&L line item mapping\n// Maps our detailed accounts to their simplified view\nconst KH_MAPPING = {\n  income: {\n    'Sales': ['4000', '4030'], // Sales + Shipping Income\n    'Discounts': ['4010'],\n    'Refunds': ['4020'],\n    'Chargebacks': ['4040'],\n  },\n  cogs: {\n    'Product Costs': ['5000', '5030', '5040', '5050'], // COGS, inventory adjustments\n    'Shipping & Fulfillment': ['5010', '6010', '6020', '6035'], // Inbound freight, outbound shipping, 3PL, packaging\n  },\n  expenses: {\n    'Google Ads': { accounts: ['6110'], filter: (t: Transaction) => t.name.toLowerCase().includes('google') },\n    'Facebook Ads': { accounts: ['6110'], filter: (t: Transaction) => t.name.toLowerCase().includes('facebook') || t.name.toLowerCase().includes('facebk') },\n    'Other Paid Ads': { accounts: ['6110'], filter: (t: Transaction) => !t.name.toLowerCase().includes('google') && !t.name.toLowerCase().includes('facebook') && !t.name.toLowerCase().includes('facebk') },\n    'Processing Fees': { accounts: ['6055', '6065', '6075'] },\n    'Affiliate / Creator Payouts': { accounts: ['6120', '6125'] },\n    'Marketing Agencies': { accounts: ['6130'] },\n    'Shopify Apps': { accounts: ['6070'] },\n    'Marketing Software': { accounts: ['6140'] },\n    'Virtual Assistants / Contractors': { accounts: ['6240'] },\n    'Other Software': { accounts: ['6375'] },\n    'Accounting': { accounts: ['6330'] },\n    'Other Expenses': { accounts: ['6100', '6150', '6210', '6250', '6260', '6290', '6300', '6320', '6390', '6410', '6450', '6470', '6495'] },\n  }\n};\n\ninterface LineItem {\n  label: string;\n  monthlyAmounts: Record<string, number>;\n  ytd: number;\n  isTotal?: boolean;\n  isBold?: boolean;\n  indent?: number;\n  transactions?: Transaction[];\n}\n\nfunction calculateLineItems(\n  transactions: Transaction[],\n  tags: Record<string, TransactionTag>,\n  months: string[]\n): { income: LineItem[]; cogs: LineItem[]; expenses: LineItem[] } {\n  // Filter out tagged transactions\n  const activeTxns = transactions.filter(t => !tags[t.id]);\n\n  const calcAmounts = (\n    accountCodes: string[],\n    filter?: (t: Transaction) => boolean\n  ): { monthly: Record<string, number>; ytd: number; transactions: Transaction[] } => {\n    const monthly: Record<string, number> = {};\n    months.forEach(m => { monthly[m] = 0; });\n    let ytd = 0;\n    const matchedTxns: Transaction[] = [];\n\n    for (const txn of activeTxns) {\n      if (accountCodes.includes(txn.accountCode)) {\n        if (!filter || filter(txn)) {\n          if (monthly[txn.month] !== undefined) {\n            monthly[txn.month] += txn.amount;\n            ytd += txn.amount;\n            matchedTxns.push(txn);\n          }\n        }\n      }\n    }\n\n    return { monthly, ytd, transactions: matchedTxns };\n  };\n\n  // Income section\n  const incomeItems: LineItem[] = [];\n  let totalIncomeMonthly: Record<string, number> = {};\n  let totalIncomeYtd = 0;\n  months.forEach(m => { totalIncomeMonthly[m] = 0; });\n\n  for (const [label, accounts] of Object.entries(KH_MAPPING.income)) {\n    const { monthly, ytd, transactions: txns } = calcAmounts(accounts);\n    incomeItems.push({ label, monthlyAmounts: monthly, ytd, transactions: txns });\n    months.forEach(m => { totalIncomeMonthly[m] += monthly[m]; });\n    totalIncomeYtd += ytd;\n  }\n  incomeItems.push({ label: 'Total Income', monthlyAmounts: totalIncomeMonthly, ytd: totalIncomeYtd, isTotal: true, isBold: true });\n\n  // COGS section\n  const cogsItems: LineItem[] = [];\n  let totalCogsMonthly: Record<string, number> = {};\n  let totalCogsYtd = 0;\n  months.forEach(m => { totalCogsMonthly[m] = 0; });\n\n  for (const [label, accounts] of Object.entries(KH_MAPPING.cogs)) {\n    const { monthly, ytd, transactions: txns } = calcAmounts(accounts);\n    cogsItems.push({ label, monthlyAmounts: monthly, ytd, transactions: txns });\n    months.forEach(m => { totalCogsMonthly[m] += monthly[m]; });\n    totalCogsYtd += ytd;\n  }\n\n  // Gross Profit\n  const grossProfitMonthly: Record<string, number> = {};\n  months.forEach(m => { grossProfitMonthly[m] = totalIncomeMonthly[m] - totalCogsMonthly[m]; });\n  const grossProfitYtd = totalIncomeYtd - totalCogsYtd;\n  cogsItems.push({ label: 'Gross Profit', monthlyAmounts: grossProfitMonthly, ytd: grossProfitYtd, isTotal: true, isBold: true });\n\n  // Expenses section\n  const expenseItems: LineItem[] = [];\n  let totalExpensesMonthly: Record<string, number> = {};\n  let totalExpensesYtd = 0;\n  months.forEach(m => { totalExpensesMonthly[m] = 0; });\n\n  for (const [label, config] of Object.entries(KH_MAPPING.expenses)) {\n    const accounts = 'accounts' in config ? config.accounts : config;\n    const filter = 'filter' in config ? config.filter : undefined;\n    const { monthly, ytd, transactions: txns } = calcAmounts(accounts as string[], filter as ((t: Transaction) => boolean) | undefined);\n\n    // Only show if there's activity\n    if (ytd !== 0) {\n      expenseItems.push({ label, monthlyAmounts: monthly, ytd, indent: 1, transactions: txns });\n      months.forEach(m => { totalExpensesMonthly[m] += monthly[m]; });\n      totalExpensesYtd += ytd;\n    }\n  }\n  expenseItems.push({ label: 'Total Expenses', monthlyAmounts: totalExpensesMonthly, ytd: totalExpensesYtd, isTotal: true, isBold: true });\n\n  // Net Profit\n  const netProfitMonthly: Record<string, number> = {};\n  months.forEach(m => { netProfitMonthly[m] = grossProfitMonthly[m] - totalExpensesMonthly[m]; });\n  const netProfitYtd = grossProfitYtd - totalExpensesYtd;\n  expenseItems.push({ label: 'Net Profit', monthlyAmounts: netProfitMonthly, ytd: netProfitYtd, isTotal: true, isBold: true });\n\n  return { income: incomeItems, cogs: cogsItems, expenses: expenseItems };\n}\n\n// Group transactions by month\nfunction groupByMonth(transactions: Transaction[]): Record<string, Transaction[]> {\n  const grouped: Record<string, Transaction[]> = {};\n  for (const txn of transactions) {\n    if (!grouped[txn.month]) {\n      grouped[txn.month] = [];\n    }\n    grouped[txn.month].push(txn);\n  }\n  return grouped;\n}\n\n// Expandable line item row component\nfunction KHLineItemRow({\n  item,\n  months,\n  totalColorClass,\n  allowDrillDown = true\n}: {\n  item: LineItem;\n  months: string[];\n  totalColorClass: string;\n  allowDrillDown?: boolean;\n}) {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [expandedMonths, setExpandedMonths] = useState<Set<string>>(new Set());\n\n  const hasTransactions = item.transactions && item.transactions.length > 0;\n  const isExpandable = allowDrillDown && hasTransactions && !item.isTotal;\n\n  const transactionsByMonth = useMemo(() => {\n    if (!item.transactions) return {};\n    return groupByMonth(item.transactions);\n  }, [item.transactions]);\n\n  const handleToggle = () => {\n    if (isExpandable) {\n      setIsExpanded(!isExpanded);\n    }\n  };\n\n  const handleMonthToggle = (month: string) => {\n    setExpandedMonths(prev => {\n      const next = new Set(prev);\n      if (next.has(month)) {\n        next.delete(month);\n      } else {\n        next.add(month);\n      }\n      return next;\n    });\n  };\n\n  return (\n    <>\n      {/* Main row */}\n      <tr\n        className={`\n          ${item.isTotal ? `${totalColorClass} border-t-2 border-slate-300` : 'border-b border-slate-100'}\n          ${isExpandable ? 'cursor-pointer hover:bg-slate-100' : ''}\n        `}\n        onClick={handleToggle}\n      >\n        <td className={`sticky left-0 bg-inherit px-3 py-2 text-slate-900 ${item.isBold ? 'font-bold' : ''} ${item.indent ? 'pl-6' : ''}`}>\n          <div className=\"flex items-center gap-2\">\n            {isExpandable ? (\n              <ChevronIcon expanded={isExpanded} className=\"text-slate-400 flex-shrink-0\" />\n            ) : (\n              <span className=\"w-4\" />\n            )}\n            <span>{item.label}</span>\n          </div>\n        </td>\n        {months.map(month => (\n          <td\n            key={month}\n            className={`px-3 py-2 text-right font-mono text-sm\n              ${item.isBold ? 'font-bold' : ''}\n              ${item.monthlyAmounts[month] < 0 ? 'text-red-600' : 'text-slate-900'}\n            `}\n          >\n            {formatCurrency(item.monthlyAmounts[month])}\n          </td>\n        ))}\n        <td\n          className={`px-3 py-2 text-right font-mono text-sm bg-violet-50 border-l-2 border-violet-200\n            ${item.isBold ? 'font-bold' : ''}\n            ${item.ytd < 0 ? 'text-red-600' : 'text-violet-900'}\n          `}\n        >\n          {formatCurrency(item.ytd)}\n        </td>\n      </tr>\n\n      {/* Expanded transaction rows by month */}\n      {isExpanded && Object.keys(transactionsByMonth).length > 0 && (\n        <>\n          {months.filter(m => transactionsByMonth[m]?.length > 0).map(month => {\n            const monthTxns = transactionsByMonth[month] || [];\n            const monthExpanded = expandedMonths.has(month);\n\n            return (\n              <tr key={`${item.label}-${month}-group`} className=\"bg-slate-50\">\n                <td\n                  colSpan={months.length + 2}\n                  className=\"px-3 py-1 pl-10\"\n                >\n                  <div\n                    className=\"flex items-center gap-2 text-sm text-slate-600 cursor-pointer hover:text-slate-900\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleMonthToggle(month);\n                    }}\n                  >\n                    <ChevronIcon expanded={monthExpanded} className=\"text-slate-400\" />\n                    <span className=\"font-medium\">{formatMonth(month)}</span>\n                    <span className=\"text-slate-400\">({monthTxns.length} transactions)</span>\n                    <span className=\"ml-auto font-mono\">\n                      {formatCurrency(monthTxns.reduce((sum, t) => sum + t.amount, 0))}\n                    </span>\n                  </div>\n\n                  {/* Individual transactions */}\n                  {monthExpanded && (\n                    <div className=\"mt-2 space-y-1 pb-2\">\n                      {monthTxns.map(txn => (\n                        <TransactionRow key={txn.id} transaction={txn} />\n                      ))}\n                    </div>\n                  )}\n                </td>\n              </tr>\n            );\n          })}\n        </>\n      )}\n    </>\n  );\n}\n\ninterface KHBrokersViewProps {\n  allowDrillDown?: boolean;\n}\n\nexport function KHBrokersView({ allowDrillDown = true }: KHBrokersViewProps) {\n  const { state } = usePL();\n  const { transactions, months, tags } = state;\n\n  const { income, cogs, expenses } = useMemo(() => {\n    if (transactions.length === 0) return { income: [], cogs: [], expenses: [] };\n    return calculateLineItems(transactions, tags, months);\n  }, [transactions, tags, months]);\n\n  if (transactions.length === 0) return null;\n\n  const renderSection = (title: string, items: LineItem[], colorClass: string, totalColorClass: string) => (\n    <div className=\"mb-8\">\n      <div className=\"flex items-center gap-3 mb-3\">\n        <div className={`w-1.5 h-6 rounded-full ${colorClass}`} />\n        <h2 className=\"text-lg font-semibold text-slate-800\">{title}</h2>\n      </div>\n\n      <div className=\"overflow-x-auto border border-slate-200 rounded-xl shadow-sm bg-white\">\n        <table className=\"w-full min-w-max\">\n          <thead>\n            <tr className=\"bg-slate-50 border-b border-slate-200\">\n              <th className=\"sticky left-0 bg-slate-50 px-3 py-2 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-64 z-10\">\n                Account\n              </th>\n              {months.map(month => (\n                <th key={month} className=\"px-3 py-2 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider w-24\">\n                  {formatMonth(month)}\n                </th>\n              ))}\n              <th className=\"px-3 py-2 text-right text-xs font-semibold text-violet-700 uppercase tracking-wider w-28 bg-violet-100 border-l-2 border-violet-200\">\n                YTD Total\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((item, idx) => (\n              <KHLineItemRow\n                key={idx}\n                item={item}\n                months={months}\n                totalColorClass={totalColorClass}\n                allowDrillDown={allowDrillDown}\n              />\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n\n  // Extract Gross Profit and Net Profit for separate display\n  const grossProfitItem = cogs.find(i => i.label === 'Gross Profit');\n  const netProfitItem = expenses.find(i => i.label === 'Net Profit');\n  const cogsWithoutGP = cogs.filter(i => i.label !== 'Gross Profit');\n  const expensesWithoutNP = expenses.filter(i => i.label !== 'Net Profit');\n\n  const renderProfitRow = (item: LineItem, label: string, bgColor: string, borderColor: string) => {\n    if (!item) return null;\n    const margin = income[income.length - 1]?.ytd !== 0\n      ? (item.ytd / income[income.length - 1].ytd) * 100\n      : 0;\n\n    return (\n      <div className={`mb-8 overflow-x-auto border ${borderColor} rounded-xl shadow-sm`}>\n        <table className=\"w-full min-w-max\">\n          <thead>\n            <tr className={`${bgColor} border-b ${borderColor}`}>\n              <th className=\"sticky left-0 bg-inherit px-3 py-2 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-64 z-10\">\n                &nbsp;\n              </th>\n              {months.map(month => (\n                <th key={month} className=\"px-3 py-2 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider w-24\">\n                  {formatMonth(month)}\n                </th>\n              ))}\n              <th className=\"px-3 py-2 text-right text-xs font-semibold text-violet-700 uppercase tracking-wider w-28 bg-violet-100 border-l-2 border-violet-200\">\n                YTD Total\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr className={bgColor}>\n              <td className=\"sticky left-0 bg-inherit px-3 py-3 font-bold text-lg text-slate-900\">\n                {label}\n                <span className=\"ml-2 text-sm font-normal text-slate-500\">\n                  ({margin.toFixed(1)}% margin)\n                </span>\n              </td>\n              {months.map(month => (\n                <td\n                  key={month}\n                  className={`px-3 py-3 text-right font-mono font-bold text-lg\n                    ${item.monthlyAmounts[month] < 0 ? 'text-red-600' : 'text-slate-900'}\n                  `}\n                >\n                  {formatCurrency(item.monthlyAmounts[month])}\n                </td>\n              ))}\n              <td\n                className={`px-3 py-3 text-right font-mono font-bold text-lg bg-violet-100 border-l-2 border-violet-200\n                  ${item.ytd < 0 ? 'text-red-600' : 'text-violet-900'}\n                `}\n              >\n                {formatCurrency(item.ytd)}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    );\n  };\n\n  return (\n    <div>\n      {renderSection('Income', income, 'bg-emerald-500', 'bg-emerald-50')}\n      {renderSection('Cost of Goods', cogsWithoutGP, 'bg-orange-500', 'bg-orange-50')}\n      {renderProfitRow(grossProfitItem!, 'Gross Profit', 'bg-blue-50', 'border-blue-200')}\n      {renderSection('Expenses', expensesWithoutNP, 'bg-red-500', 'bg-red-50')}\n      {renderProfitRow(netProfitItem!, 'Net Profit', 'bg-green-50', 'border-green-200')}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2059, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/tagging/ExcludedSection.tsx"],"sourcesContent":["'use client';\n\nimport { useMemo, useState } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { formatCurrency } from '@/lib/csvParser';\nimport { ChevronIcon } from '@/components/ui/ChevronIcon';\nimport { Exclusion } from '@/types';\n\ninterface GroupedExclusions {\n  [category: string]: {\n    exclusions: Exclusion[];\n    total: number;\n    justification: string;\n  };\n}\n\nexport function ExcludedSection() {\n  const { state } = usePL();\n  const [isMainExpanded, setIsMainExpanded] = useState(false);\n  const [expandedCategories, setExpandedCategories] = useState<Set<string>>(new Set());\n\n  const grouped = useMemo((): GroupedExclusions => {\n    const result: GroupedExclusions = {};\n\n    for (const exclusion of state.exclusions) {\n      if (!result[exclusion.category]) {\n        result[exclusion.category] = {\n          exclusions: [],\n          total: 0,\n          justification: exclusion.justification\n        };\n      }\n      result[exclusion.category].exclusions.push(exclusion);\n      result[exclusion.category].total += exclusion.amount;\n    }\n\n    return result;\n  }, [state.exclusions]);\n\n  const totalExcluded = useMemo(() => {\n    return state.exclusions.reduce((sum, e) => sum + e.amount, 0);\n  }, [state.exclusions]);\n\n  const categories = Object.keys(grouped).sort();\n\n  if (state.exclusions.length === 0) return null;\n\n  const toggleCategory = (category: string) => {\n    const newExpanded = new Set(expandedCategories);\n    if (newExpanded.has(category)) {\n      newExpanded.delete(category);\n    } else {\n      newExpanded.add(category);\n    }\n    setExpandedCategories(newExpanded);\n  };\n\n  // Category colors\n  const getCategoryColor = (category: string): string => {\n    const colors: Record<string, string> = {\n      'Personal': 'bg-purple-500',\n      'Discretionary': 'bg-purple-400',\n      'Owner Travel': 'bg-blue-500',\n      'Owner Education': 'bg-blue-400',\n      'Owner Tools': 'bg-blue-300',\n      'Owner Expense': 'bg-blue-600',\n      'Legal': 'bg-red-500',\n      'Legal/Tax': 'bg-red-400',\n      'One-Time Project': 'bg-amber-500',\n      'One-Time COGS': 'bg-amber-400',\n      'Terminated Agency': 'bg-orange-500',\n      'Terminated Contractor': 'bg-orange-400',\n      'Terminated Service': 'bg-orange-300',\n      'M&A Process': 'bg-slate-500',\n    };\n    return colors[category] || 'bg-slate-400';\n  };\n\n  return (\n    <div className=\"mt-10 pt-8 border-t border-slate-200\">\n      {/* Main Header - Collapsible */}\n      <div\n        className=\"flex items-center gap-3 mb-4 cursor-pointer group\"\n        onClick={() => setIsMainExpanded(!isMainExpanded)}\n      >\n        <ChevronIcon expanded={isMainExpanded} className=\"text-slate-400 group-hover:text-slate-600 transition-colors\" />\n        <div className=\"w-1.5 h-6 rounded-full bg-slate-400\" />\n        <h2 className=\"text-lg font-semibold text-slate-700 group-hover:text-slate-900 transition-colors\">Exclusions</h2>\n        <span className=\"text-sm text-slate-400\">\n          {state.exclusions.length} items\n        </span>\n        <span className=\"ml-auto font-mono font-semibold text-slate-500\">\n          {formatCurrency(totalExcluded)}\n        </span>\n      </div>\n\n      {isMainExpanded && (\n        <div className=\"space-y-2 pl-6\">\n          {/* Summary by category */}\n          <p className=\"text-sm text-slate-500 mb-4\">\n            Non-recurring or owner-related items that would not transfer to a buyer.\n          </p>\n\n          {categories.map(category => {\n            const data = grouped[category];\n            const isExpanded = expandedCategories.has(category);\n\n            return (\n              <div key={category} className=\"border border-slate-200 rounded-lg overflow-hidden bg-white\">\n                {/* Category Header */}\n                <div\n                  className=\"flex items-center gap-3 px-4 py-2.5 bg-slate-50/80 cursor-pointer hover:bg-slate-100 transition-colors\"\n                  onClick={() => toggleCategory(category)}\n                >\n                  <ChevronIcon expanded={isExpanded} className=\"text-slate-400\" />\n                  <div className={`w-2 h-2 rounded-full ${getCategoryColor(category)}`} />\n                  <span className=\"font-medium text-slate-800\">{category}</span>\n                  <span className=\"text-sm text-slate-400\">\n                    {data.exclusions.length}\n                  </span>\n                  <span className=\"ml-auto text-xs text-slate-400 max-w-sm truncate hidden md:block\">\n                    {data.justification}\n                  </span>\n                  <span className=\"font-mono text-sm text-slate-600 ml-4\">\n                    {formatCurrency(data.total)}\n                  </span>\n                </div>\n\n                {/* Transactions */}\n                {isExpanded && (\n                  <div className=\"divide-y divide-slate-100\">\n                    {data.exclusions.map((exc, idx) => (\n                      <div\n                        key={`${exc.date}-${exc.amount}-${idx}`}\n                        className=\"flex items-center gap-4 px-6 py-2 bg-white text-sm hover:bg-slate-50/50 transition-colors\"\n                      >\n                        <span className=\"text-slate-400 font-mono text-xs w-20\">{exc.date}</span>\n                        <span className=\"text-slate-700 flex-1 truncate\">\n                          {exc.vendor || exc.memo?.substring(0, 40) || 'Unknown'}\n                        </span>\n                        <span className=\"text-slate-400 text-xs w-28 truncate hidden lg:block\">\n                          {exc.account.replace(/^\\d{4}\\s+/, '')}\n                        </span>\n                        <span className=\"font-mono text-slate-600 w-24 text-right\">\n                          {formatCurrency(exc.amount)}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2332, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/components/pnl/PLViewer.tsx"],"sourcesContent":["'use client';\n\nimport { usePL } from '@/context/PLContext';\nimport { SummaryCards } from './SummaryCards';\nimport { PLSection } from './PLSection';\nimport { GrossProfitRow } from './GrossProfitRow';\nimport { KHBrokersView } from './KHBrokersView';\nimport { ExcludedSection } from '@/components/tagging/ExcludedSection';\n\ninterface PLViewerProps {\n  allowDrillDown?: boolean;\n}\n\nexport function PLViewer({ allowDrillDown = true }: PLViewerProps) {\n  const { state, dispatch } = usePL();\n\n  if (state.loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"flex items-center gap-3 text-slate-500\">\n          <svg className=\"animate-spin h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          <span>Loading financial data...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (state.error) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-red-600 bg-red-50 px-6 py-4 rounded-lg border border-red-200\">\n          <strong>Error:</strong> {state.error}\n        </div>\n      </div>\n    );\n  }\n\n  const toggleView = () => {\n    dispatch({ type: 'TOGGLE_KH_BROKERS_VIEW' });\n  };\n\n  return (\n    <div>\n      {/* View Toggle - only show in data room */}\n      {allowDrillDown && (\n        <div className=\"flex items-center justify-end mb-6\">\n          <div className=\"inline-flex rounded-lg border border-slate-200 bg-white p-1 shadow-sm\">\n            <button\n              onClick={() => state.khBrokersView || toggleView()}\n              className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${\n                state.khBrokersView\n                  ? 'bg-slate-900 text-white shadow-sm'\n                  : 'text-slate-500 hover:text-slate-700 hover:bg-slate-50'\n              }`}\n            >\n              Summary\n            </button>\n            <button\n              onClick={() => !state.khBrokersView || toggleView()}\n              className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${\n                !state.khBrokersView\n                  ? 'bg-slate-900 text-white shadow-sm'\n                  : 'text-slate-500 hover:text-slate-700 hover:bg-slate-50'\n              }`}\n            >\n              Detailed\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Summary Cards */}\n      <SummaryCards />\n\n      {/* If no drill-down allowed, always show simplified view without expansion */}\n      {!allowDrillDown ? (\n        <KHBrokersView allowDrillDown={false} />\n      ) : state.khBrokersView ? (\n        /* KH Brokers Simplified View */\n        <KHBrokersView allowDrillDown={true} />\n      ) : (\n        /* Detailed View */\n        <>\n          {/* Revenue Section */}\n          <PLSection\n            section=\"revenue\"\n            title=\"Revenue\"\n            colorClass=\"bg-emerald-500\"\n            totalColorClass=\"bg-emerald-50\"\n            allowDrillDown={allowDrillDown}\n          />\n\n          {/* COGS Section */}\n          <PLSection\n            section=\"cogs\"\n            title=\"Cost of Goods Sold\"\n            colorClass=\"bg-orange-500\"\n            totalColorClass=\"bg-orange-50\"\n            allowDrillDown={allowDrillDown}\n          />\n\n          {/* Cost of Sales Section */}\n          <PLSection\n            section=\"costOfSales\"\n            title=\"Cost of Sales\"\n            colorClass=\"bg-amber-500\"\n            totalColorClass=\"bg-amber-50\"\n            allowDrillDown={allowDrillDown}\n          />\n\n          {/* Gross Profit */}\n          <GrossProfitRow type=\"grossProfit\" />\n\n          {/* Operating Expenses */}\n          <PLSection\n            section=\"operatingExpenses\"\n            title=\"Operating Expenses\"\n            colorClass=\"bg-red-500\"\n            totalColorClass=\"bg-red-50\"\n            allowDrillDown={allowDrillDown}\n          />\n\n          {/* Net Income */}\n          <GrossProfitRow type=\"netIncome\" />\n        </>\n      )}\n\n      {/* Excluded/Tagged Section - only shown in data room */}\n      {allowDrillDown && <ExcludedSection />}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;AAaO,SAAS,SAAS,EAAE,iBAAiB,IAAI,EAAiB;IAC/D,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAA,qJAAK;IAEjC,IAAI,MAAM,OAAO,EAAE;QACjB,qBACE,8PAAC;YAAI,WAAU;sBACb,cAAA,8PAAC;gBAAI,WAAU;;kCACb,8PAAC;wBAAI,WAAU;wBAAuB,OAAM;wBAA6B,MAAK;wBAAO,SAAQ;;0CAC3F,8PAAC;gCAAO,WAAU;gCAAa,IAAG;gCAAK,IAAG;gCAAK,GAAE;gCAAK,QAAO;gCAAe,aAAY;;;;;;0CACxF,8PAAC;gCAAK,WAAU;gCAAa,MAAK;gCAAe,GAAE;;;;;;;;;;;;kCAErD,8PAAC;kCAAK;;;;;;;;;;;;;;;;;IAId;IAEA,IAAI,MAAM,KAAK,EAAE;QACf,qBACE,8PAAC;YAAI,WAAU;sBACb,cAAA,8PAAC;gBAAI,WAAU;;kCACb,8PAAC;kCAAO;;;;;;oBAAe;oBAAE,MAAM,KAAK;;;;;;;;;;;;IAI5C;IAEA,MAAM,aAAa;QACjB,SAAS;YAAE,MAAM;QAAyB;IAC5C;IAEA,qBACE,8PAAC;;YAEE,gCACC,8PAAC;gBAAI,WAAU;0BACb,cAAA,8PAAC;oBAAI,WAAU;;sCACb,8PAAC;4BACC,SAAS,IAAM,MAAM,aAAa,IAAI;4BACtC,WAAW,CAAC,wDAAwD,EAClE,MAAM,aAAa,GACf,sCACA,yDACJ;sCACH;;;;;;sCAGD,8PAAC;4BACC,SAAS,IAAM,CAAC,MAAM,aAAa,IAAI;4BACvC,WAAW,CAAC,wDAAwD,EAClE,CAAC,MAAM,aAAa,GAChB,sCACA,yDACJ;sCACH;;;;;;;;;;;;;;;;;0BAQP,8PAAC,yKAAY;;;;;YAGZ,CAAC,+BACA,8PAAC,2KAAa;gBAAC,gBAAgB;;;;;uBAC7B,MAAM,aAAa,GACrB,8BAA8B,iBAC9B,8PAAC,2KAAa;gBAAC,gBAAgB;;;;;uBAE/B,iBAAiB,iBACjB;;kCAEE,8PAAC,mKAAS;wBACR,SAAQ;wBACR,OAAM;wBACN,YAAW;wBACX,iBAAgB;wBAChB,gBAAgB;;;;;;kCAIlB,8PAAC,mKAAS;wBACR,SAAQ;wBACR,OAAM;wBACN,YAAW;wBACX,iBAAgB;wBAChB,gBAAgB;;;;;;kCAIlB,8PAAC,mKAAS;wBACR,SAAQ;wBACR,OAAM;wBACN,YAAW;wBACX,iBAAgB;wBAChB,gBAAgB;;;;;;kCAIlB,8PAAC,6KAAc;wBAAC,MAAK;;;;;;kCAGrB,8PAAC,mKAAS;wBACR,SAAQ;wBACR,OAAM;wBACN,YAAW;wBACX,iBAAgB;wBAChB,gBAAgB;;;;;;kCAIlB,8PAAC,6KAAc;wBAAC,MAAK;;;;;;;;YAKxB,gCAAkB,8PAAC,mLAAe;;;;;;;;;;;AAGzC"}},
    {"offset": {"line": 2574, "column": 0}, "map": {"version":3,"sources":["file:///Users/robertonoel/Desktop/repos/spicy-pnl/src/app/dataroom/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from \"next/link\";\nimport { PLViewer } from \"@/components/pnl/PLViewer\";\n\nexport default function DataRoomPage() {\n  const router = useRouter();\n  const [isAuthorized, setIsAuthorized] = useState(false);\n  const [isChecking, setIsChecking] = useState(true);\n\n  useEffect(() => {\n    // Check if user has unlocked the data room\n    const unlocked = sessionStorage.getItem('dataRoomUnlocked');\n    if (unlocked === 'true') {\n      setIsAuthorized(true);\n    } else {\n      router.push('/');\n    }\n    setIsChecking(false);\n  }, [router]);\n\n  if (isChecking) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-slate-50\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-amber-500\" />\n      </div>\n    );\n  }\n\n  if (!isAuthorized) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      {/* Header */}\n      <header className=\"bg-white border-b border-slate-200/80 sticky top-0 z-50 backdrop-blur-sm bg-white/95\">\n        <div className=\"max-w-[1800px] mx-auto px-6 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <Link\n                href=\"/\"\n                className=\"flex items-center gap-2 text-slate-500 hover:text-slate-900 transition-colors\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n                </svg>\n                <span className=\"text-sm font-medium\">Back</span>\n              </Link>\n              <div className=\"h-6 w-px bg-slate-200\" />\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-6 h-6 rounded bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center\">\n                  <svg className=\"w-3.5 h-3.5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z\" />\n                  </svg>\n                </div>\n                <h1 className=\"text-xl font-bold text-slate-900\">\n                  Full Data Room\n                </h1>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-sm font-medium text-slate-600\">\n                Jan - Nov 2025\n              </span>\n              <span className=\"text-xs text-amber-600 bg-amber-50 px-3 py-1.5 rounded-full border border-amber-200\">\n                Confidential\n              </span>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <main className=\"flex-1 max-w-[1800px] w-full mx-auto px-6 py-8\">\n        <PLViewer />\n      </main>\n\n      {/* Footer */}\n      <footer className=\"border-t border-slate-200/80 bg-white/80 backdrop-blur-sm\">\n        <div className=\"max-w-[1800px] mx-auto px-6 py-4\">\n          <p className=\"text-xs text-slate-400 text-center\">\n            Confidential - For Qualified Buyers Under NDA Only\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACtB,MAAM,SAAS,IAAA,+JAAS;IACxB,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iOAAQ,EAAC;IACjD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iOAAQ,EAAC;IAE7C,IAAA,kOAAS,EAAC;QACR,2CAA2C;QAC3C,MAAM,WAAW,eAAe,OAAO,CAAC;QACxC,IAAI,aAAa,QAAQ;YACvB,gBAAgB;QAClB,OAAO;YACL,OAAO,IAAI,CAAC;QACd;QACA,cAAc;IAChB,GAAG;QAAC;KAAO;IAEX,IAAI,YAAY;QACd,qBACE,8PAAC;YAAI,WAAU;sBACb,cAAA,8PAAC;gBAAI,WAAU;;;;;;;;;;;IAGrB;IAEA,IAAI,CAAC,cAAc;QACjB,OAAO;IACT;IAEA,qBACE,8PAAC;QAAI,WAAU;;0BAEb,8PAAC;gBAAO,WAAU;0BAChB,cAAA,8PAAC;oBAAI,WAAU;8BACb,cAAA,8PAAC;wBAAI,WAAU;;0CACb,8PAAC;gCAAI,WAAU;;kDACb,8PAAC,uLAAI;wCACH,MAAK;wCACL,WAAU;;0DAEV,8PAAC;gDAAI,WAAU;gDAAU,MAAK;gDAAO,QAAO;gDAAe,SAAQ;0DACjE,cAAA,8PAAC;oDAAK,eAAc;oDAAQ,gBAAe;oDAAQ,aAAa;oDAAG,GAAE;;;;;;;;;;;0DAEvE,8PAAC;gDAAK,WAAU;0DAAsB;;;;;;;;;;;;kDAExC,8PAAC;wCAAI,WAAU;;;;;;kDACf,8PAAC;wCAAI,WAAU;;0DACb,8PAAC;gDAAI,WAAU;0DACb,cAAA,8PAAC;oDAAI,WAAU;oDAAyB,MAAK;oDAAO,QAAO;oDAAe,SAAQ;8DAChF,cAAA,8PAAC;wDAAK,eAAc;wDAAQ,gBAAe;wDAAQ,aAAa;wDAAG,GAAE;;;;;;;;;;;;;;;;0DAGzE,8PAAC;gDAAG,WAAU;0DAAmC;;;;;;;;;;;;;;;;;;0CAKrD,8PAAC;gCAAI,WAAU;;kDACb,8PAAC;wCAAK,WAAU;kDAAqC;;;;;;kDAGrD,8PAAC;wCAAK,WAAU;kDAAsF;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAS9G,8PAAC;gBAAK,WAAU;0BACd,cAAA,8PAAC,iKAAQ;;;;;;;;;;0BAIX,8PAAC;gBAAO,WAAU;0BAChB,cAAA,8PAAC;oBAAI,WAAU;8BACb,cAAA,8PAAC;wBAAE,WAAU;kCAAqC;;;;;;;;;;;;;;;;;;;;;;AAO5D"}}]
}