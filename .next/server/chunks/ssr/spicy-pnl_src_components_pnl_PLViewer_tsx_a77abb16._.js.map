{"version":3,"sources":["../../../../../spicy-pnl/src/components/pnl/PLViewer.tsx","../../../../../spicy-pnl/src/components/pnl/SummaryCards.tsx","../../../../../spicy-pnl/src/components/ui/ChevronIcon.tsx","../../../../../spicy-pnl/src/components/tagging/TagModal.tsx","../../../../../spicy-pnl/src/components/pnl/TransactionRow.tsx","../../../../../spicy-pnl/src/components/pnl/PLRow.tsx","../../../../../spicy-pnl/src/components/pnl/PLSection.tsx","../../../../../spicy-pnl/src/components/pnl/GrossProfitRow.tsx","../../../../../spicy-pnl/src/components/pnl/KHBrokersView.tsx","../../../../../spicy-pnl/src/components/tagging/ExcludedSection.tsx"],"sourcesContent":["'use client';\n\nimport { usePL } from '@/context/PLContext';\nimport { SummaryCards } from './SummaryCards';\nimport { PLSection } from './PLSection';\nimport { GrossProfitRow } from './GrossProfitRow';\nimport { KHBrokersView } from './KHBrokersView';\nimport { ExcludedSection } from '@/components/tagging/ExcludedSection';\n\ninterface PLViewerProps {\n  allowDrillDown?: boolean;\n}\n\nexport function PLViewer({ allowDrillDown = true }: PLViewerProps) {\n  const { state, dispatch } = usePL();\n\n  if (state.loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"flex items-center gap-3 text-slate-500\">\n          <svg className=\"animate-spin h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n          <span>Loading financial data...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (state.error) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-red-600 bg-red-50 px-6 py-4 rounded-lg border border-red-200\">\n          <strong>Error:</strong> {state.error}\n        </div>\n      </div>\n    );\n  }\n\n  const toggleView = () => {\n    dispatch({ type: 'TOGGLE_KH_BROKERS_VIEW' });\n  };\n\n  return (\n    <div>\n      {/* View Toggle - only show in data room */}\n      {allowDrillDown && (\n        <div className=\"flex items-center justify-end mb-6\">\n          <div className=\"inline-flex rounded-lg border border-slate-200 bg-white p-1 shadow-sm\">\n            <button\n              onClick={() => state.khBrokersView || toggleView()}\n              className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${\n                state.khBrokersView\n                  ? 'bg-slate-900 text-white shadow-sm'\n                  : 'text-slate-500 hover:text-slate-700 hover:bg-slate-50'\n              }`}\n            >\n              Summary\n            </button>\n            <button\n              onClick={() => !state.khBrokersView || toggleView()}\n              className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${\n                !state.khBrokersView\n                  ? 'bg-slate-900 text-white shadow-sm'\n                  : 'text-slate-500 hover:text-slate-700 hover:bg-slate-50'\n              }`}\n            >\n              Detailed\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Summary Cards */}\n      <SummaryCards />\n\n      {/* If no drill-down allowed, always show simplified view without expansion */}\n      {!allowDrillDown ? (\n        <KHBrokersView allowDrillDown={false} />\n      ) : state.khBrokersView ? (\n        /* KH Brokers Simplified View */\n        <KHBrokersView allowDrillDown={true} />\n      ) : (\n        /* Detailed View */\n        <>\n          {/* Revenue Section */}\n          <PLSection\n            section=\"revenue\"\n            title=\"Revenue\"\n            colorClass=\"bg-emerald-500\"\n            totalColorClass=\"bg-emerald-50\"\n            allowDrillDown={allowDrillDown}\n          />\n\n          {/* COGS Section */}\n          <PLSection\n            section=\"cogs\"\n            title=\"Cost of Goods Sold\"\n            colorClass=\"bg-orange-500\"\n            totalColorClass=\"bg-orange-50\"\n            allowDrillDown={allowDrillDown}\n          />\n\n          {/* Cost of Sales Section */}\n          <PLSection\n            section=\"costOfSales\"\n            title=\"Cost of Sales\"\n            colorClass=\"bg-amber-500\"\n            totalColorClass=\"bg-amber-50\"\n            allowDrillDown={allowDrillDown}\n          />\n\n          {/* Gross Profit */}\n          <GrossProfitRow type=\"grossProfit\" />\n\n          {/* Operating Expenses */}\n          <PLSection\n            section=\"operatingExpenses\"\n            title=\"Operating Expenses\"\n            colorClass=\"bg-red-500\"\n            totalColorClass=\"bg-red-50\"\n            allowDrillDown={allowDrillDown}\n          />\n\n          {/* Net Income */}\n          <GrossProfitRow type=\"netIncome\" />\n        </>\n      )}\n\n      {/* Excluded/Tagged Section - only shown in data room */}\n      {allowDrillDown && <ExcludedSection />}\n    </div>\n  );\n}\n","'use client';\n\nimport { useMemo } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { calculatePLSummary } from '@/lib/calculations';\nimport { formatCurrency } from '@/lib/csvParser';\n\nexport function SummaryCards() {\n  const { state } = usePL();\n\n  const summary = useMemo(() => {\n    if (state.transactions.length === 0) return null;\n    return calculatePLSummary(state.transactions, state.accounts, state.tags);\n  }, [state.transactions, state.accounts, state.tags]);\n\n  if (!summary) return null;\n\n  const cards = [\n    {\n      label: 'Net Revenue',\n      value: summary.netRevenue,\n      color: 'bg-blue-50 border-blue-200',\n      textColor: 'text-blue-700',\n      valueColor: 'text-blue-900'\n    },\n    {\n      label: 'Net Income',\n      value: summary.netIncome,\n      subLabel: `${summary.netMargin.toFixed(1)}% margin`,\n      color: summary.netIncome >= 0 ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200',\n      textColor: summary.netIncome >= 0 ? 'text-green-700' : 'text-red-700',\n      valueColor: summary.netIncome >= 0 ? 'text-green-900' : 'text-red-900'\n    }\n  ];\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8\">\n      {cards.map((card) => (\n        <div\n          key={card.label}\n          className={`${card.color} border rounded-xl p-5 shadow-sm transition-shadow hover:shadow-md`}\n        >\n          <div className={`text-sm font-medium ${card.textColor} uppercase tracking-wide`}>\n            {card.label}\n          </div>\n          <div className={`text-3xl font-bold ${card.valueColor} mt-2 font-mono`}>\n            {formatCurrency(card.value)}\n          </div>\n          {card.subLabel && (\n            <div className={`text-sm ${card.textColor} mt-2 opacity-80`}>\n              {card.subLabel}\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n","'use client';\n\ninterface ChevronIconProps {\n  expanded: boolean;\n  className?: string;\n}\n\nexport function ChevronIcon({ expanded, className = '' }: ChevronIconProps) {\n  return (\n    <svg\n      className={`w-4 h-4 transition-transform duration-200 ${expanded ? 'rotate-90' : ''} ${className}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <path\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        strokeWidth={2}\n        d=\"M9 5l7 7-7 7\"\n      />\n    </svg>\n  );\n}\n","'use client';\n\nimport { useState } from 'react';\nimport { Transaction } from '@/types';\nimport { usePL } from '@/context/PLContext';\nimport { formatCurrency } from '@/lib/csvParser';\n\ninterface TagModalProps {\n  transaction: Transaction;\n  onClose: () => void;\n}\n\nexport function TagModal({ transaction, onClose }: TagModalProps) {\n  const { state, dispatch } = usePL();\n  const [activeTab, setActiveTab] = useState<'personal' | 'nonRecurring'>('personal');\n  const [newSubAccount, setNewSubAccount] = useState('');\n  const [showNewInput, setShowNewInput] = useState(false);\n\n  const handleTag = (subAccount: string) => {\n    dispatch({\n      type: 'TAG_TRANSACTION',\n      payload: {\n        transactionId: transaction.id,\n        tag: {\n          category: activeTab,\n          subAccount,\n          taggedAt: Date.now()\n        }\n      }\n    });\n    onClose();\n  };\n\n  const handleAddNew = () => {\n    if (newSubAccount.trim()) {\n      dispatch({\n        type: 'ADD_SUB_ACCOUNT',\n        payload: { category: activeTab, name: newSubAccount.trim() }\n      });\n      handleTag(newSubAccount.trim());\n    }\n  };\n\n  const subAccounts = state.tagConfig[activeTab];\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-white rounded-lg shadow-xl w-full max-w-md mx-4\"\n        onClick={e => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"px-4 py-3 border-b border-slate-200\">\n          <h3 className=\"font-semibold text-slate-900\">Tag Transaction</h3>\n          <p className=\"text-sm text-slate-500 mt-1 truncate\">\n            {transaction.name || transaction.memo} - {formatCurrency(transaction.amount)}\n          </p>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"flex border-b border-slate-200\">\n          <button\n            className={`flex-1 px-4 py-2 text-sm font-medium border-b-2 transition-colors\n              ${activeTab === 'personal'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-slate-500 hover:text-slate-700'\n              }\n            `}\n            onClick={() => setActiveTab('personal')}\n          >\n            Personal\n          </button>\n          <button\n            className={`flex-1 px-4 py-2 text-sm font-medium border-b-2 transition-colors\n              ${activeTab === 'nonRecurring'\n                ? 'border-blue-500 text-blue-600'\n                : 'border-transparent text-slate-500 hover:text-slate-700'\n              }\n            `}\n            onClick={() => setActiveTab('nonRecurring')}\n          >\n            Non-Recurring\n          </button>\n        </div>\n\n        {/* Sub-account list */}\n        <div className=\"p-4 max-h-64 overflow-y-auto\">\n          <div className=\"space-y-2\">\n            {subAccounts.map(subAccount => (\n              <button\n                key={subAccount}\n                onClick={() => handleTag(subAccount)}\n                className=\"w-full text-left px-3 py-2 rounded-lg hover:bg-slate-100 text-slate-700 transition-colors\"\n              >\n                {subAccount}\n              </button>\n            ))}\n\n            {/* Add new option */}\n            {!showNewInput ? (\n              <button\n                onClick={() => setShowNewInput(true)}\n                className=\"w-full text-left px-3 py-2 rounded-lg hover:bg-blue-50 text-blue-600 transition-colors flex items-center gap-2\"\n              >\n                <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                </svg>\n                Add new sub-account\n              </button>\n            ) : (\n              <div className=\"flex gap-2\">\n                <input\n                  type=\"text\"\n                  value={newSubAccount}\n                  onChange={e => setNewSubAccount(e.target.value)}\n                  placeholder=\"Enter name...\"\n                  className=\"flex-1 px-3 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  autoFocus\n                  onKeyDown={e => {\n                    if (e.key === 'Enter') handleAddNew();\n                    if (e.key === 'Escape') setShowNewInput(false);\n                  }}\n                />\n                <button\n                  onClick={handleAddNew}\n                  disabled={!newSubAccount.trim()}\n                  className=\"px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  Add\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"px-4 py-3 border-t border-slate-200 flex justify-end\">\n          <button\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm text-slate-600 hover:text-slate-800\"\n          >\n            Cancel\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","'use client';\n\nimport { useState } from 'react';\nimport { Transaction } from '@/types';\nimport { usePL } from '@/context/PLContext';\nimport { formatCurrency } from '@/lib/csvParser';\nimport { TagModal } from '@/components/tagging/TagModal';\n\ninterface TransactionRowProps {\n  transaction: Transaction;\n}\n\nexport function TransactionRow({ transaction }: TransactionRowProps) {\n  const { state, dispatch } = usePL();\n  const [showTagModal, setShowTagModal] = useState(false);\n\n  const tag = state.tags[transaction.id];\n  const isTagged = !!tag;\n\n  const handleUntag = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    dispatch({ type: 'UNTAG_TRANSACTION', payload: transaction.id });\n  };\n\n  const formatDate = (dateStr: string) => {\n    const [month, day] = dateStr.split('/');\n    return `${month}/${day}`;\n  };\n\n  return (\n    <>\n      <div\n        className={`\n          flex items-center gap-3 py-1.5 px-2 rounded text-sm\n          ${isTagged ? 'bg-amber-50 opacity-60' : 'bg-white hover:bg-slate-50'}\n        `}\n      >\n        {/* Date */}\n        <span className=\"text-slate-400 font-mono text-xs w-12 flex-shrink-0\">\n          {formatDate(transaction.transactionDate)}\n        </span>\n\n        {/* Name/Vendor */}\n        <span className={`font-medium w-32 flex-shrink-0 truncate ${isTagged ? 'line-through text-slate-400' : 'text-slate-700'}`}>\n          {transaction.name || '-'}\n        </span>\n\n        {/* Memo */}\n        <span className={`flex-1 truncate ${isTagged ? 'line-through text-slate-400' : 'text-slate-500'}`}>\n          {transaction.memo || transaction.transactionType}\n        </span>\n\n        {/* Tag badge */}\n        {isTagged && (\n          <span className=\"bg-amber-200 text-amber-800 text-xs px-2 py-0.5 rounded-full flex-shrink-0\">\n            {tag.subAccount}\n          </span>\n        )}\n\n        {/* Amount */}\n        <span className={`font-mono text-right w-24 flex-shrink-0\n          ${isTagged ? 'line-through text-slate-400' : transaction.amount < 0 ? 'text-red-600' : 'text-slate-700'}\n        `}>\n          {formatCurrency(transaction.amount)}\n        </span>\n\n        {/* Tag/Untag button */}\n        {isTagged ? (\n          <button\n            onClick={handleUntag}\n            className=\"text-xs text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-50 flex-shrink-0\"\n          >\n            Untag\n          </button>\n        ) : (\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              setShowTagModal(true);\n            }}\n            className=\"text-xs text-blue-600 hover:text-blue-800 px-2 py-1 rounded hover:bg-blue-50 flex-shrink-0\"\n          >\n            Tag\n          </button>\n        )}\n      </div>\n\n      {/* Tag Modal */}\n      {showTagModal && (\n        <TagModal\n          transaction={transaction}\n          onClose={() => setShowTagModal(false)}\n        />\n      )}\n    </>\n  );\n}\n","'use client';\n\nimport { useMemo } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { PLRow as PLRowType, Transaction } from '@/types';\nimport { ChevronIcon } from '@/components/ui/ChevronIcon';\nimport { formatCurrency, formatMonth } from '@/lib/csvParser';\nimport { getAccountTransactions, groupTransactionsByMonth, calculateMonthlyAmounts } from '@/lib/calculations';\nimport { TransactionRow } from './TransactionRow';\n\ninterface PLRowProps {\n  row: PLRowType;\n  months: string[];\n  depth?: number;\n  isChild?: boolean;\n  allowDrillDown?: boolean;\n}\n\nexport function PLRow({ row, months, depth = 0, isChild = false, allowDrillDown = true }: PLRowProps) {\n  const { state, dispatch } = usePL();\n  const { expandedAccounts, expandedMonths, transactions, accounts, tags } = state;\n\n  const isExpanded = allowDrillDown && expandedAccounts.has(row.accountCode);\n  const hasChildren = row.account.children.length > 0;\n  const hasTransactions = row.transactionCount > 0;\n  const isExpandable = allowDrillDown && (hasChildren || hasTransactions);\n\n  // Get child rows if expanded\n  const childRows = useMemo(() => {\n    if (!isExpanded || !hasChildren) return [];\n\n    return row.account.children\n      .map(childCode => {\n        const childAccount = accounts.get(childCode);\n        if (!childAccount) return null;\n\n        const { monthlyAmounts, ytdTotal, transactionCount } = calculateMonthlyAmounts(\n          childCode, transactions, accounts, months, tags\n        );\n\n        if (ytdTotal === 0 && transactionCount === 0) return null;\n\n        return {\n          accountCode: childCode,\n          account: childAccount,\n          monthlyAmounts,\n          ytdTotal,\n          transactionCount\n        } as PLRowType;\n      })\n      .filter((r): r is PLRowType => r !== null);\n  }, [isExpanded, hasChildren, row.account.children, accounts, transactions, months, tags]);\n\n  // Get transactions grouped by month if expanded (only for leaf nodes)\n  const transactionsByMonth = useMemo(() => {\n    if (!isExpanded || hasChildren) return {};\n\n    const txns = getAccountTransactions(row.accountCode, transactions, accounts, tags);\n    return groupTransactionsByMonth(txns);\n  }, [isExpanded, hasChildren, row.accountCode, transactions, accounts, tags]);\n\n  const handleToggle = () => {\n    if (isExpandable) {\n      dispatch({ type: 'TOGGLE_ACCOUNT', payload: row.accountCode });\n    }\n  };\n\n  const handleMonthToggle = (month: string) => {\n    const key = `${row.accountCode}-${month}`;\n    dispatch({ type: 'TOGGLE_MONTH', payload: key });\n  };\n\n  const isMonthExpanded = (month: string) => {\n    return expandedMonths.has(`${row.accountCode}-${month}`);\n  };\n\n  const indentPadding = depth * 20;\n\n  return (\n    <>\n      {/* Main account row */}\n      <tr\n        className={`\n          ${isChild ? 'bg-slate-50/50' : 'bg-white'}\n          ${isExpandable ? 'cursor-pointer hover:bg-slate-100' : ''}\n          border-b border-slate-100\n        `}\n        onClick={handleToggle}\n      >\n        {/* Account name column */}\n        <td\n          className=\"sticky left-0 bg-inherit px-3 py-2 font-medium text-slate-900 whitespace-nowrap z-10\"\n          style={{ paddingLeft: `${12 + indentPadding}px` }}\n        >\n          <div className=\"flex items-center gap-2\">\n            {isExpandable ? (\n              <ChevronIcon expanded={isExpanded} className=\"text-slate-400 flex-shrink-0\" />\n            ) : (\n              <span className=\"w-4\" />\n            )}\n            <span className={depth > 0 ? 'text-sm' : ''}>\n              {row.account.name}\n            </span>\n          </div>\n        </td>\n\n        {/* Monthly amounts */}\n        {months.map(month => (\n          <td\n            key={month}\n            className={`px-3 py-2 text-right font-mono text-sm whitespace-nowrap\n              ${row.monthlyAmounts[month] < 0 ? 'text-red-600' : 'text-slate-700'}\n            `}\n          >\n            {row.monthlyAmounts[month] !== 0 ? formatCurrency(row.monthlyAmounts[month]) : '-'}\n          </td>\n        ))}\n\n        {/* YTD Total */}\n        <td\n          className={`px-3 py-2 text-right font-mono text-sm font-semibold whitespace-nowrap bg-violet-50 border-l-2 border-violet-200\n            ${row.ytdTotal < 0 ? 'text-red-600' : 'text-violet-900'}\n          `}\n        >\n          {formatCurrency(row.ytdTotal)}\n        </td>\n      </tr>\n\n      {/* Child account rows */}\n      {isExpanded && childRows.map(childRow => (\n        <PLRow\n          key={childRow.accountCode}\n          row={childRow}\n          months={months}\n          depth={depth + 1}\n          isChild\n          allowDrillDown={allowDrillDown}\n        />\n      ))}\n\n      {/* Transaction month groups (for leaf nodes) */}\n      {isExpanded && !hasChildren && Object.keys(transactionsByMonth).length > 0 && (\n        <>\n          {months.filter(m => transactionsByMonth[m]?.length > 0).map(month => {\n            const monthTxns = transactionsByMonth[month] || [];\n            const monthExpanded = isMonthExpanded(month);\n\n            return (\n              <tr key={`${row.accountCode}-${month}-group`} className=\"bg-slate-50\">\n                <td\n                  colSpan={months.length + 2}\n                  className=\"px-3 py-1\"\n                  style={{ paddingLeft: `${32 + indentPadding}px` }}\n                >\n                  <div\n                    className=\"flex items-center gap-2 text-sm text-slate-600 cursor-pointer hover:text-slate-900\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleMonthToggle(month);\n                    }}\n                  >\n                    <ChevronIcon expanded={monthExpanded} className=\"text-slate-400\" />\n                    <span className=\"font-medium\">{formatMonth(month)}</span>\n                    <span className=\"text-slate-400\">({monthTxns.length} transactions)</span>\n                    <span className=\"ml-auto font-mono\">\n                      {formatCurrency(monthTxns.reduce((sum, t) => sum + t.amount, 0))}\n                    </span>\n                  </div>\n\n                  {/* Individual transactions */}\n                  {monthExpanded && (\n                    <div className=\"mt-2 space-y-1 pb-2\">\n                      {monthTxns.map(txn => (\n                        <TransactionRow key={txn.id} transaction={txn} />\n                      ))}\n                    </div>\n                  )}\n                </td>\n              </tr>\n            );\n          })}\n        </>\n      )}\n    </>\n  );\n}\n","'use client';\n\nimport { useMemo } from 'react';\nimport { PLSection as PLSectionType, PLRow as PLRowType } from '@/types';\nimport { usePL } from '@/context/PLContext';\nimport { buildPLRows, calculateSectionMonthlyTotal } from '@/lib/calculations';\nimport { formatCurrency, formatMonth } from '@/lib/csvParser';\nimport { PLRow } from './PLRow';\n\ninterface PLSectionProps {\n  section: PLSectionType;\n  title: string;\n  colorClass: string;\n  totalColorClass?: string;\n  allowDrillDown?: boolean;\n}\n\nexport function PLSection({ section, title, colorClass, totalColorClass, allowDrillDown = true }: PLSectionProps) {\n  const { state } = usePL();\n  const { transactions, accounts, months, tags } = state;\n\n  const rows = useMemo(() => {\n    if (transactions.length === 0) return [];\n    return buildPLRows(section, transactions, accounts, months, tags);\n  }, [section, transactions, accounts, months, tags]);\n\n  const sectionTotals = useMemo(() => {\n    const totals: Record<string, number> = {};\n    let ytd = 0;\n\n    months.forEach(month => {\n      const total = calculateSectionMonthlyTotal(section, transactions, accounts, month, tags);\n      totals[month] = total;\n      ytd += total;\n    });\n\n    return { monthly: totals, ytd };\n  }, [section, transactions, accounts, months, tags]);\n\n  if (rows.length === 0) return null;\n\n  return (\n    <div className=\"mb-8\">\n      {/* Section Header */}\n      <div className={`flex items-center gap-3 mb-3`}>\n        <div className={`w-1.5 h-6 rounded-full ${colorClass}`} />\n        <h2 className=\"text-lg font-semibold text-slate-800\">{title}</h2>\n      </div>\n\n      {/* Table */}\n      <div className=\"overflow-x-auto border border-slate-200 rounded-xl shadow-sm bg-white\">\n        <table className=\"w-full min-w-max\">\n          <thead>\n            <tr className=\"bg-slate-50 border-b border-slate-200\">\n              <th className=\"sticky left-0 bg-slate-50 px-3 py-2 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-64 z-10\">\n                Account\n              </th>\n              {months.map(month => (\n                <th\n                  key={month}\n                  className=\"px-3 py-2 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider w-24\"\n                >\n                  {formatMonth(month)}\n                </th>\n              ))}\n              <th className=\"px-3 py-2 text-right text-xs font-semibold text-violet-700 uppercase tracking-wider w-28 bg-violet-100 border-l-2 border-violet-200\">\n                YTD Total\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {rows.map(row => (\n              <PLRow key={row.accountCode} row={row} months={months} allowDrillDown={allowDrillDown} />\n            ))}\n\n            {/* Section Total Row */}\n            <tr className={`${totalColorClass || 'bg-slate-50'} border-t-2 border-slate-300`}>\n              <td className=\"sticky left-0 bg-inherit px-3 py-2 font-bold text-slate-900\">\n                Total {title}\n              </td>\n              {months.map(month => (\n                <td\n                  key={month}\n                  className={`px-3 py-2 text-right font-mono text-sm font-bold\n                    ${sectionTotals.monthly[month] < 0 ? 'text-red-600' : 'text-slate-900'}\n                  `}\n                >\n                  {formatCurrency(sectionTotals.monthly[month])}\n                </td>\n              ))}\n              <td\n                className={`px-3 py-2 text-right font-mono text-sm font-bold bg-violet-100 border-l-2 border-violet-200\n                  ${sectionTotals.ytd < 0 ? 'text-red-600' : 'text-violet-900'}\n                `}\n              >\n                {formatCurrency(sectionTotals.ytd)}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n","'use client';\n\nimport { useMemo } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { calculateSectionMonthlyTotal } from '@/lib/calculations';\nimport { formatCurrency, formatMonth } from '@/lib/csvParser';\n\ninterface GrossProfitRowProps {\n  type: 'grossProfit' | 'netIncome';\n}\n\nexport function GrossProfitRow({ type }: GrossProfitRowProps) {\n  const { state } = usePL();\n  const { transactions, accounts, months, tags } = state;\n\n  const calculations = useMemo(() => {\n    const revenue: Record<string, number> = {};\n    const cogs: Record<string, number> = {};\n    const costOfSales: Record<string, number> = {};\n    const opex: Record<string, number> = {};\n    const other: Record<string, number> = {};\n\n    let revenueYtd = 0, cogsYtd = 0, cosYtd = 0, opexYtd = 0, otherYtd = 0;\n\n    months.forEach(month => {\n      revenue[month] = calculateSectionMonthlyTotal('revenue', transactions, accounts, month, tags);\n      cogs[month] = calculateSectionMonthlyTotal('cogs', transactions, accounts, month, tags);\n      costOfSales[month] = calculateSectionMonthlyTotal('costOfSales', transactions, accounts, month, tags);\n      opex[month] = calculateSectionMonthlyTotal('operatingExpenses', transactions, accounts, month, tags);\n      other[month] = calculateSectionMonthlyTotal('otherIncome', transactions, accounts, month, tags);\n\n      revenueYtd += revenue[month];\n      cogsYtd += cogs[month];\n      cosYtd += costOfSales[month];\n      opexYtd += opex[month];\n      otherYtd += other[month];\n    });\n\n    const grossProfit: Record<string, number> = {};\n    const netIncome: Record<string, number> = {};\n    let gpYtd = 0, niYtd = 0;\n\n    months.forEach(month => {\n      grossProfit[month] = revenue[month] - cogs[month] - costOfSales[month];\n      netIncome[month] = grossProfit[month] - opex[month] + other[month];\n      gpYtd += grossProfit[month];\n      niYtd += netIncome[month];\n    });\n\n    return {\n      grossProfit: { monthly: grossProfit, ytd: gpYtd },\n      netIncome: { monthly: netIncome, ytd: niYtd },\n      revenue: { monthly: revenue, ytd: revenueYtd }\n    };\n  }, [transactions, accounts, months, tags]);\n\n  if (transactions.length === 0) return null;\n\n  const data = type === 'grossProfit' ? calculations.grossProfit : calculations.netIncome;\n  const label = type === 'grossProfit' ? 'Gross Profit' : 'Net Income';\n  const bgColor = type === 'grossProfit' ? 'bg-blue-50' : 'bg-green-50';\n  const borderColor = type === 'grossProfit' ? 'border-blue-200' : 'border-green-200';\n\n  // Calculate margin\n  const margin = calculations.revenue.ytd !== 0\n    ? (data.ytd / calculations.revenue.ytd) * 100\n    : 0;\n\n  return (\n    <div className={`mb-8 overflow-x-auto border ${borderColor} rounded-xl shadow-sm`}>\n      <table className=\"w-full min-w-max\">\n        <thead>\n          <tr className={`${bgColor} border-b ${borderColor}`}>\n            <th className=\"sticky left-0 bg-inherit px-3 py-2 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-64 z-10\">\n              &nbsp;\n            </th>\n            {months.map(month => (\n              <th\n                key={month}\n                className=\"px-3 py-2 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider w-24\"\n              >\n                {formatMonth(month)}\n              </th>\n            ))}\n            <th className=\"px-3 py-2 text-right text-xs font-semibold text-violet-700 uppercase tracking-wider w-28 bg-violet-100 border-l-2 border-violet-200\">\n              YTD Total\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr className={bgColor}>\n            <td className=\"sticky left-0 bg-inherit px-3 py-3 font-bold text-lg text-slate-900\">\n              {label}\n              <span className=\"ml-2 text-sm font-normal text-slate-500\">\n                ({margin.toFixed(1)}% margin)\n              </span>\n            </td>\n            {months.map(month => (\n              <td\n                key={month}\n                className={`px-3 py-3 text-right font-mono font-bold text-lg\n                  ${data.monthly[month] < 0 ? 'text-red-600' : 'text-slate-900'}\n                `}\n              >\n                {formatCurrency(data.monthly[month])}\n              </td>\n            ))}\n            <td\n              className={`px-3 py-3 text-right font-mono font-bold text-lg bg-violet-100 border-l-2 border-violet-200\n                ${data.ytd < 0 ? 'text-red-600' : 'text-violet-900'}\n              `}\n            >\n              {formatCurrency(data.ytd)}\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  );\n}\n","'use client';\n\nimport { useMemo, useState } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { formatCurrency, formatMonth } from '@/lib/csvParser';\nimport { Transaction, TransactionTag } from '@/types';\nimport { ChevronIcon } from '@/components/ui/ChevronIcon';\nimport { TransactionRow } from './TransactionRow';\n\n// KH Brokers P&L line item mapping\n// Maps our detailed accounts to their simplified view\nconst KH_MAPPING = {\n  income: {\n    'Sales': ['4000', '4030'], // Sales + Shipping Income\n    'Discounts': ['4010'],\n    'Refunds': ['4020'],\n    'Chargebacks': ['4040'],\n  },\n  cogs: {\n    'Product Costs': ['5000', '5030', '5040', '5050'], // COGS, inventory adjustments\n    'Shipping & Fulfillment': ['5010', '6010', '6020', '6035'], // Inbound freight, outbound shipping, 3PL, packaging\n  },\n  expenses: {\n    'Google Ads': { accounts: ['6110'], filter: (t: Transaction) => t.name.toLowerCase().includes('google') },\n    'Facebook Ads': { accounts: ['6110'], filter: (t: Transaction) => t.name.toLowerCase().includes('facebook') || t.name.toLowerCase().includes('facebk') },\n    'Other Paid Ads': { accounts: ['6110'], filter: (t: Transaction) => !t.name.toLowerCase().includes('google') && !t.name.toLowerCase().includes('facebook') && !t.name.toLowerCase().includes('facebk') },\n    'Processing Fees': { accounts: ['6055', '6065', '6075'] },\n    'Affiliate / Creator Payouts': { accounts: ['6120', '6125'] },\n    'Marketing Agencies': { accounts: ['6130'] },\n    'Shopify Apps': { accounts: ['6070'] },\n    'Marketing Software': { accounts: ['6140'] },\n    'Virtual Assistants / Contractors': { accounts: ['6240'] },\n    'Other Software': { accounts: ['6375'] },\n    'Accounting': { accounts: ['6330'] },\n    'Other Expenses': { accounts: ['6100', '6150', '6210', '6250', '6260', '6290', '6300', '6320', '6390', '6410', '6450', '6470', '6495'] },\n  }\n};\n\ninterface LineItem {\n  label: string;\n  monthlyAmounts: Record<string, number>;\n  ytd: number;\n  isTotal?: boolean;\n  isBold?: boolean;\n  indent?: number;\n  transactions?: Transaction[];\n}\n\nfunction calculateLineItems(\n  transactions: Transaction[],\n  tags: Record<string, TransactionTag>,\n  months: string[]\n): { income: LineItem[]; cogs: LineItem[]; expenses: LineItem[] } {\n  // Filter out tagged transactions\n  const activeTxns = transactions.filter(t => !tags[t.id]);\n\n  const calcAmounts = (\n    accountCodes: string[],\n    filter?: (t: Transaction) => boolean\n  ): { monthly: Record<string, number>; ytd: number; transactions: Transaction[] } => {\n    const monthly: Record<string, number> = {};\n    months.forEach(m => { monthly[m] = 0; });\n    let ytd = 0;\n    const matchedTxns: Transaction[] = [];\n\n    for (const txn of activeTxns) {\n      if (accountCodes.includes(txn.accountCode)) {\n        if (!filter || filter(txn)) {\n          if (monthly[txn.month] !== undefined) {\n            monthly[txn.month] += txn.amount;\n            ytd += txn.amount;\n            matchedTxns.push(txn);\n          }\n        }\n      }\n    }\n\n    return { monthly, ytd, transactions: matchedTxns };\n  };\n\n  // Income section\n  const incomeItems: LineItem[] = [];\n  let totalIncomeMonthly: Record<string, number> = {};\n  let totalIncomeYtd = 0;\n  months.forEach(m => { totalIncomeMonthly[m] = 0; });\n\n  for (const [label, accounts] of Object.entries(KH_MAPPING.income)) {\n    const { monthly, ytd, transactions: txns } = calcAmounts(accounts);\n    incomeItems.push({ label, monthlyAmounts: monthly, ytd, transactions: txns });\n    months.forEach(m => { totalIncomeMonthly[m] += monthly[m]; });\n    totalIncomeYtd += ytd;\n  }\n  incomeItems.push({ label: 'Total Income', monthlyAmounts: totalIncomeMonthly, ytd: totalIncomeYtd, isTotal: true, isBold: true });\n\n  // COGS section\n  const cogsItems: LineItem[] = [];\n  let totalCogsMonthly: Record<string, number> = {};\n  let totalCogsYtd = 0;\n  months.forEach(m => { totalCogsMonthly[m] = 0; });\n\n  for (const [label, accounts] of Object.entries(KH_MAPPING.cogs)) {\n    const { monthly, ytd, transactions: txns } = calcAmounts(accounts);\n    cogsItems.push({ label, monthlyAmounts: monthly, ytd, transactions: txns });\n    months.forEach(m => { totalCogsMonthly[m] += monthly[m]; });\n    totalCogsYtd += ytd;\n  }\n\n  // Gross Profit\n  const grossProfitMonthly: Record<string, number> = {};\n  months.forEach(m => { grossProfitMonthly[m] = totalIncomeMonthly[m] - totalCogsMonthly[m]; });\n  const grossProfitYtd = totalIncomeYtd - totalCogsYtd;\n  cogsItems.push({ label: 'Gross Profit', monthlyAmounts: grossProfitMonthly, ytd: grossProfitYtd, isTotal: true, isBold: true });\n\n  // Expenses section\n  const expenseItems: LineItem[] = [];\n  let totalExpensesMonthly: Record<string, number> = {};\n  let totalExpensesYtd = 0;\n  months.forEach(m => { totalExpensesMonthly[m] = 0; });\n\n  for (const [label, config] of Object.entries(KH_MAPPING.expenses)) {\n    const accounts = 'accounts' in config ? config.accounts : config;\n    const filter = 'filter' in config ? config.filter : undefined;\n    const { monthly, ytd, transactions: txns } = calcAmounts(accounts as string[], filter as ((t: Transaction) => boolean) | undefined);\n\n    // Only show if there's activity\n    if (ytd !== 0) {\n      expenseItems.push({ label, monthlyAmounts: monthly, ytd, indent: 1, transactions: txns });\n      months.forEach(m => { totalExpensesMonthly[m] += monthly[m]; });\n      totalExpensesYtd += ytd;\n    }\n  }\n  expenseItems.push({ label: 'Total Expenses', monthlyAmounts: totalExpensesMonthly, ytd: totalExpensesYtd, isTotal: true, isBold: true });\n\n  // Net Profit\n  const netProfitMonthly: Record<string, number> = {};\n  months.forEach(m => { netProfitMonthly[m] = grossProfitMonthly[m] - totalExpensesMonthly[m]; });\n  const netProfitYtd = grossProfitYtd - totalExpensesYtd;\n  expenseItems.push({ label: 'Net Profit', monthlyAmounts: netProfitMonthly, ytd: netProfitYtd, isTotal: true, isBold: true });\n\n  return { income: incomeItems, cogs: cogsItems, expenses: expenseItems };\n}\n\n// Group transactions by month\nfunction groupByMonth(transactions: Transaction[]): Record<string, Transaction[]> {\n  const grouped: Record<string, Transaction[]> = {};\n  for (const txn of transactions) {\n    if (!grouped[txn.month]) {\n      grouped[txn.month] = [];\n    }\n    grouped[txn.month].push(txn);\n  }\n  return grouped;\n}\n\n// Expandable line item row component\nfunction KHLineItemRow({\n  item,\n  months,\n  totalColorClass,\n  allowDrillDown = true\n}: {\n  item: LineItem;\n  months: string[];\n  totalColorClass: string;\n  allowDrillDown?: boolean;\n}) {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [expandedMonths, setExpandedMonths] = useState<Set<string>>(new Set());\n\n  const hasTransactions = item.transactions && item.transactions.length > 0;\n  const isExpandable = allowDrillDown && hasTransactions && !item.isTotal;\n\n  const transactionsByMonth = useMemo(() => {\n    if (!item.transactions) return {};\n    return groupByMonth(item.transactions);\n  }, [item.transactions]);\n\n  const handleToggle = () => {\n    if (isExpandable) {\n      setIsExpanded(!isExpanded);\n    }\n  };\n\n  const handleMonthToggle = (month: string) => {\n    setExpandedMonths(prev => {\n      const next = new Set(prev);\n      if (next.has(month)) {\n        next.delete(month);\n      } else {\n        next.add(month);\n      }\n      return next;\n    });\n  };\n\n  return (\n    <>\n      {/* Main row */}\n      <tr\n        className={`\n          ${item.isTotal ? `${totalColorClass} border-t-2 border-slate-300` : 'border-b border-slate-100'}\n          ${isExpandable ? 'cursor-pointer hover:bg-slate-100' : ''}\n        `}\n        onClick={handleToggle}\n      >\n        <td className={`sticky left-0 bg-inherit px-3 py-2 text-slate-900 ${item.isBold ? 'font-bold' : ''} ${item.indent ? 'pl-6' : ''}`}>\n          <div className=\"flex items-center gap-2\">\n            {isExpandable ? (\n              <ChevronIcon expanded={isExpanded} className=\"text-slate-400 flex-shrink-0\" />\n            ) : (\n              <span className=\"w-4\" />\n            )}\n            <span>{item.label}</span>\n          </div>\n        </td>\n        {months.map(month => (\n          <td\n            key={month}\n            className={`px-3 py-2 text-right font-mono text-sm\n              ${item.isBold ? 'font-bold' : ''}\n              ${item.monthlyAmounts[month] < 0 ? 'text-red-600' : 'text-slate-900'}\n            `}\n          >\n            {formatCurrency(item.monthlyAmounts[month])}\n          </td>\n        ))}\n        <td\n          className={`px-3 py-2 text-right font-mono text-sm bg-violet-50 border-l-2 border-violet-200\n            ${item.isBold ? 'font-bold' : ''}\n            ${item.ytd < 0 ? 'text-red-600' : 'text-violet-900'}\n          `}\n        >\n          {formatCurrency(item.ytd)}\n        </td>\n      </tr>\n\n      {/* Expanded transaction rows by month */}\n      {isExpanded && Object.keys(transactionsByMonth).length > 0 && (\n        <>\n          {months.filter(m => transactionsByMonth[m]?.length > 0).map(month => {\n            const monthTxns = transactionsByMonth[month] || [];\n            const monthExpanded = expandedMonths.has(month);\n\n            return (\n              <tr key={`${item.label}-${month}-group`} className=\"bg-slate-50\">\n                <td\n                  colSpan={months.length + 2}\n                  className=\"px-3 py-1 pl-10\"\n                >\n                  <div\n                    className=\"flex items-center gap-2 text-sm text-slate-600 cursor-pointer hover:text-slate-900\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleMonthToggle(month);\n                    }}\n                  >\n                    <ChevronIcon expanded={monthExpanded} className=\"text-slate-400\" />\n                    <span className=\"font-medium\">{formatMonth(month)}</span>\n                    <span className=\"text-slate-400\">({monthTxns.length} transactions)</span>\n                    <span className=\"ml-auto font-mono\">\n                      {formatCurrency(monthTxns.reduce((sum, t) => sum + t.amount, 0))}\n                    </span>\n                  </div>\n\n                  {/* Individual transactions */}\n                  {monthExpanded && (\n                    <div className=\"mt-2 space-y-1 pb-2\">\n                      {monthTxns.map(txn => (\n                        <TransactionRow key={txn.id} transaction={txn} />\n                      ))}\n                    </div>\n                  )}\n                </td>\n              </tr>\n            );\n          })}\n        </>\n      )}\n    </>\n  );\n}\n\ninterface KHBrokersViewProps {\n  allowDrillDown?: boolean;\n}\n\nexport function KHBrokersView({ allowDrillDown = true }: KHBrokersViewProps) {\n  const { state } = usePL();\n  const { transactions, months, tags } = state;\n\n  const { income, cogs, expenses } = useMemo(() => {\n    if (transactions.length === 0) return { income: [], cogs: [], expenses: [] };\n    return calculateLineItems(transactions, tags, months);\n  }, [transactions, tags, months]);\n\n  if (transactions.length === 0) return null;\n\n  const renderSection = (title: string, items: LineItem[], colorClass: string, totalColorClass: string) => (\n    <div className=\"mb-8\">\n      <div className=\"flex items-center gap-3 mb-3\">\n        <div className={`w-1.5 h-6 rounded-full ${colorClass}`} />\n        <h2 className=\"text-lg font-semibold text-slate-800\">{title}</h2>\n      </div>\n\n      <div className=\"overflow-x-auto border border-slate-200 rounded-xl shadow-sm bg-white\">\n        <table className=\"w-full min-w-max\">\n          <thead>\n            <tr className=\"bg-slate-50 border-b border-slate-200\">\n              <th className=\"sticky left-0 bg-slate-50 px-3 py-2 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-64 z-10\">\n                Account\n              </th>\n              {months.map(month => (\n                <th key={month} className=\"px-3 py-2 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider w-24\">\n                  {formatMonth(month)}\n                </th>\n              ))}\n              <th className=\"px-3 py-2 text-right text-xs font-semibold text-violet-700 uppercase tracking-wider w-28 bg-violet-100 border-l-2 border-violet-200\">\n                YTD Total\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((item, idx) => (\n              <KHLineItemRow\n                key={idx}\n                item={item}\n                months={months}\n                totalColorClass={totalColorClass}\n                allowDrillDown={allowDrillDown}\n              />\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n\n  // Extract Gross Profit and Net Profit for separate display\n  const grossProfitItem = cogs.find(i => i.label === 'Gross Profit');\n  const netProfitItem = expenses.find(i => i.label === 'Net Profit');\n  const cogsWithoutGP = cogs.filter(i => i.label !== 'Gross Profit');\n  const expensesWithoutNP = expenses.filter(i => i.label !== 'Net Profit');\n\n  const renderProfitRow = (item: LineItem, label: string, bgColor: string, borderColor: string) => {\n    if (!item) return null;\n    const margin = income[income.length - 1]?.ytd !== 0\n      ? (item.ytd / income[income.length - 1].ytd) * 100\n      : 0;\n\n    return (\n      <div className={`mb-8 overflow-x-auto border ${borderColor} rounded-xl shadow-sm`}>\n        <table className=\"w-full min-w-max\">\n          <thead>\n            <tr className={`${bgColor} border-b ${borderColor}`}>\n              <th className=\"sticky left-0 bg-inherit px-3 py-2 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-64 z-10\">\n                &nbsp;\n              </th>\n              {months.map(month => (\n                <th key={month} className=\"px-3 py-2 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider w-24\">\n                  {formatMonth(month)}\n                </th>\n              ))}\n              <th className=\"px-3 py-2 text-right text-xs font-semibold text-violet-700 uppercase tracking-wider w-28 bg-violet-100 border-l-2 border-violet-200\">\n                YTD Total\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr className={bgColor}>\n              <td className=\"sticky left-0 bg-inherit px-3 py-3 font-bold text-lg text-slate-900\">\n                {label}\n                <span className=\"ml-2 text-sm font-normal text-slate-500\">\n                  ({margin.toFixed(1)}% margin)\n                </span>\n              </td>\n              {months.map(month => (\n                <td\n                  key={month}\n                  className={`px-3 py-3 text-right font-mono font-bold text-lg\n                    ${item.monthlyAmounts[month] < 0 ? 'text-red-600' : 'text-slate-900'}\n                  `}\n                >\n                  {formatCurrency(item.monthlyAmounts[month])}\n                </td>\n              ))}\n              <td\n                className={`px-3 py-3 text-right font-mono font-bold text-lg bg-violet-100 border-l-2 border-violet-200\n                  ${item.ytd < 0 ? 'text-red-600' : 'text-violet-900'}\n                `}\n              >\n                {formatCurrency(item.ytd)}\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    );\n  };\n\n  return (\n    <div>\n      {renderSection('Income', income, 'bg-emerald-500', 'bg-emerald-50')}\n      {renderSection('Cost of Goods', cogsWithoutGP, 'bg-orange-500', 'bg-orange-50')}\n      {renderProfitRow(grossProfitItem!, 'Gross Profit', 'bg-blue-50', 'border-blue-200')}\n      {renderSection('Expenses', expensesWithoutNP, 'bg-red-500', 'bg-red-50')}\n      {renderProfitRow(netProfitItem!, 'Net Profit', 'bg-green-50', 'border-green-200')}\n    </div>\n  );\n}\n","'use client';\n\nimport { useMemo, useState } from 'react';\nimport { usePL } from '@/context/PLContext';\nimport { formatCurrency } from '@/lib/csvParser';\nimport { ChevronIcon } from '@/components/ui/ChevronIcon';\nimport { Exclusion } from '@/types';\n\ninterface GroupedExclusions {\n  [category: string]: {\n    exclusions: Exclusion[];\n    total: number;\n    justification: string;\n  };\n}\n\nexport function ExcludedSection() {\n  const { state } = usePL();\n  const [isMainExpanded, setIsMainExpanded] = useState(false);\n  const [expandedCategories, setExpandedCategories] = useState<Set<string>>(new Set());\n\n  const grouped = useMemo((): GroupedExclusions => {\n    const result: GroupedExclusions = {};\n\n    for (const exclusion of state.exclusions) {\n      if (!result[exclusion.category]) {\n        result[exclusion.category] = {\n          exclusions: [],\n          total: 0,\n          justification: exclusion.justification\n        };\n      }\n      result[exclusion.category].exclusions.push(exclusion);\n      result[exclusion.category].total += exclusion.amount;\n    }\n\n    return result;\n  }, [state.exclusions]);\n\n  const totalExcluded = useMemo(() => {\n    return state.exclusions.reduce((sum, e) => sum + e.amount, 0);\n  }, [state.exclusions]);\n\n  const categories = Object.keys(grouped).sort();\n\n  if (state.exclusions.length === 0) return null;\n\n  const toggleCategory = (category: string) => {\n    const newExpanded = new Set(expandedCategories);\n    if (newExpanded.has(category)) {\n      newExpanded.delete(category);\n    } else {\n      newExpanded.add(category);\n    }\n    setExpandedCategories(newExpanded);\n  };\n\n  // Category colors\n  const getCategoryColor = (category: string): string => {\n    const colors: Record<string, string> = {\n      'Personal': 'bg-purple-500',\n      'Discretionary': 'bg-purple-400',\n      'Owner Travel': 'bg-blue-500',\n      'Owner Education': 'bg-blue-400',\n      'Owner Tools': 'bg-blue-300',\n      'Owner Expense': 'bg-blue-600',\n      'Legal': 'bg-red-500',\n      'Legal/Tax': 'bg-red-400',\n      'One-Time Project': 'bg-amber-500',\n      'One-Time COGS': 'bg-amber-400',\n      'Terminated Agency': 'bg-orange-500',\n      'Terminated Contractor': 'bg-orange-400',\n      'Terminated Service': 'bg-orange-300',\n      'M&A Process': 'bg-slate-500',\n    };\n    return colors[category] || 'bg-slate-400';\n  };\n\n  return (\n    <div className=\"mt-10 pt-8 border-t border-slate-200\">\n      {/* Main Header - Collapsible */}\n      <div\n        className=\"flex items-center gap-3 mb-4 cursor-pointer group\"\n        onClick={() => setIsMainExpanded(!isMainExpanded)}\n      >\n        <ChevronIcon expanded={isMainExpanded} className=\"text-slate-400 group-hover:text-slate-600 transition-colors\" />\n        <div className=\"w-1.5 h-6 rounded-full bg-slate-400\" />\n        <h2 className=\"text-lg font-semibold text-slate-700 group-hover:text-slate-900 transition-colors\">Exclusions</h2>\n        <span className=\"text-sm text-slate-400\">\n          {state.exclusions.length} items\n        </span>\n        <span className=\"ml-auto font-mono font-semibold text-slate-500\">\n          {formatCurrency(totalExcluded)}\n        </span>\n      </div>\n\n      {isMainExpanded && (\n        <div className=\"space-y-2 pl-6\">\n          {/* Summary by category */}\n          <p className=\"text-sm text-slate-500 mb-4\">\n            Non-recurring or owner-related items that would not transfer to a buyer.\n          </p>\n\n          {categories.map(category => {\n            const data = grouped[category];\n            const isExpanded = expandedCategories.has(category);\n\n            return (\n              <div key={category} className=\"border border-slate-200 rounded-lg overflow-hidden bg-white\">\n                {/* Category Header */}\n                <div\n                  className=\"flex items-center gap-3 px-4 py-2.5 bg-slate-50/80 cursor-pointer hover:bg-slate-100 transition-colors\"\n                  onClick={() => toggleCategory(category)}\n                >\n                  <ChevronIcon expanded={isExpanded} className=\"text-slate-400\" />\n                  <div className={`w-2 h-2 rounded-full ${getCategoryColor(category)}`} />\n                  <span className=\"font-medium text-slate-800\">{category}</span>\n                  <span className=\"text-sm text-slate-400\">\n                    {data.exclusions.length}\n                  </span>\n                  <span className=\"ml-auto text-xs text-slate-400 max-w-sm truncate hidden md:block\">\n                    {data.justification}\n                  </span>\n                  <span className=\"font-mono text-sm text-slate-600 ml-4\">\n                    {formatCurrency(data.total)}\n                  </span>\n                </div>\n\n                {/* Transactions */}\n                {isExpanded && (\n                  <div className=\"divide-y divide-slate-100\">\n                    {data.exclusions.map((exc, idx) => (\n                      <div\n                        key={`${exc.date}-${exc.amount}-${idx}`}\n                        className=\"flex items-center gap-4 px-6 py-2 bg-white text-sm hover:bg-slate-50/50 transition-colors\"\n                      >\n                        <span className=\"text-slate-400 font-mono text-xs w-20\">{exc.date}</span>\n                        <span className=\"text-slate-700 flex-1 truncate\">\n                          {exc.vendor || exc.memo?.substring(0, 40) || 'Unknown'}\n                        </span>\n                        <span className=\"text-slate-400 text-xs w-28 truncate hidden lg:block\">\n                          {exc.account.replace(/^\\d{4}\\s+/, '')}\n                        </span>\n                        <span className=\"font-mono text-slate-600 w-24 text-right\">\n                          {formatCurrency(exc.amount)}\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}